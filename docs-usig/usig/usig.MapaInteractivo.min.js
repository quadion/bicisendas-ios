jQuery.extendIf=function(b,d){if(b&&d){for(var a in d){if(typeof b[a]=="undefined"){b[a]=d[a]}}}return b};if(typeof(Ext)=="undefined"){jQuery.extend(Function.prototype,{createCallback:function(){var a=arguments;var b=this;return function(){return b.apply(window,a)}},createDelegate:function(c,b,a){var d=this;return function(){var f=b||arguments;if(a===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(b)}else{if(typeof a=="number"){f=Array.prototype.slice.call(arguments,0);var e=[a,0].concat(b);Array.prototype.splice.apply(f,e)}}return d.apply(c||window,f)}},defer:function(c,e,b,a){var d=this.createDelegate(e,b,a);if(c){return setTimeout(d,c)}d();return 0},createSequence:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){var d=c.apply(this||window,arguments);b.apply(a||this||window,arguments);return d}},createInterceptor:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){b.target=this;b.method=c;if(b.apply(a||this||window,arguments)===false){return}return c.apply(this||window,arguments)}}});jQuery.extendIf(String,{escape:function(a){return a.replace(/('|\\)/g,"\\$1")},leftPad:function(d,b,c){var a=new String(d);if(!c){c=" "}while(a.length<b){a=c+a}return a.toString()},format:function(b){var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}})}String.prototype.isInteger=function(){return !isNaN(parseInt(this))};String.prototype.isFloat=function(){return !isNaN(parseFloat(this))};String.prototype.toggle=function(b,a){return this==b?a:b};String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return this.replace(a,"")}}();String.prototype.translate=function(d,c){if(!(d.length&&c.length)||d.length!=c.length){return this}var b=this;for(var a=0;a<d.length;a++){if(typeof(d)=="string"){b=b.replace(new RegExp(d.charAt(a),"g"),c.charAt(a))}else{b=b.replace(new RegExp(d[a],"g"),c[a])}}return b};String.prototype.isDigit=function(){return/^\d+$/.test(this)};String.prototype.removeWords=function(e){var d=this.split(" ");var c=new Array();for(var b=0;b<d.length;b++){c.push(d[b]);for(var a=0;a<e.length;a++){if(c[b]==e[a]){c.pop();break}}}return c.join(" ")};jQuery.extendIf(Number.prototype,{constrain:function(b,a){return Math.min(Math.max(this,b),a)},isInteger:function(){return !isNaN(parseInt(this))},isFloat:function(){return !isNaN(parseFloat(this))}});jQuery.extendIf(Array.prototype,{indexOf:function(c){for(var b=0,a=this.length;b<a;b++){if(this[b]==c){return b}}return -1},removeObject:function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}return this},binarySearch:function binarySearch(f,b){var a=0,e=this.length-1,c,d;while(a<=e){c=parseInt((a+e)/2,10);d=b(this[c],f);if(d<0){a=c+1;continue}if(d>0){e=c-1;continue}return c}return -1},inject:function(c,b){for(var a=0;a<this.length;a++){c=b(c,this[a],a)}return c},map:function(d,c){var a=new Array(this.length);for(var b=0,e=this.length;b<e;b++){if(b in this){a[b]=d.call(c,this[b],b,this)}}return a},intersect:function(){if(!arguments.length){return[]}var e=this;var d=a2=null;var h=0;while(h<arguments.length){d=[];a2=arguments[h];var c=e.length;var b=a2.length;for(var g=0;g<c;g++){for(var f=0;f<b;f++){if(e[g]===a2[f]){d.push(e[g])}}}e=d;h++}return d.unique()},unique:function(){var c=[];var b=this.length;for(var e=0;e<b;e++){for(var d=e+1;d<b;d++){if(this[e]===this[d]){d=++e}}c.push(this[e])}return c}});Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())};if(typeof(usig)=="undefined"){usig={}}usig.debug=function(a){if(window.console&&window.console.log){window.console.log(a)}};if(typeof(usig)=="undefined"){usig={}}usig.Location=function(b,a,c){this.lat=b;this.lng=a;this.desc=c;this.toString=function(){return this.desc||"Ubicación actual"};this.getCoordenadas=function(){return new usig.Punto(this.lng,this.lat)};this.setLatLng=function(e,d){this.lat=e;this.lng=d};this.getLatLng=function(){if(L&&L.latLng){return L.latLng(this.lat,this.lng)}else{return this.getCoordenadas()}}};jQuery.extendIf(usig,{loadingJs:[],loadingJsListeners:{},__callLoadJsListeners:function(b){for(var c=0,a=usig.loadingJsListeners[b].length;c<a;c++){usig.loadingJsListeners[b][c]()}},loadJs:function(b,e){if(usig.loadingJs.indexOf(b)<0){usig.loadingJs.push(b);usig.loadingJsListeners[b]=(typeof(e)=="function")?[e]:[];var a=document.createElement("script"),c=document.getElementsByTagName("head")[0],d=false;a.onload=a.onreadystatechange=function(){if((a.readyState&&a.readyState!=="complete"&&a.readyState!=="loaded")||d){return false}a.onload=a.onreadystatechange=null;d=true;usig.__callLoadJsListeners(b)};a.src=b;c.insertBefore(a,c.firstChild)}else{usig.loadingJsListeners[b].push(e)}},loadCss:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);if(typeof b!="undefined"){document.getElementsByTagName("head")[0].appendChild(b)}},removeJs:function(a){var c=document.getElementsByTagName("script");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("src")!=null&&c[b].getAttribute("src").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},removeCss:function(a){var c=document.getElementsByTagName("link");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("href")!=null&&c[b].getAttribute("href").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},Animator:function(c,d,e,f){var b=0;function a(){if(c.length>b){d(c[b]);b++;setTimeout(a,e)}else{if(typeof(f)=="function"){f()}}}this.stop=function(){b=c.length+1};a()},parseUri:function(e){var a=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],b=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),d={};for(var c=0;c<10;c++){d[a[c]]=(b[c]?b[c]:"")}if(d.directoryPath.length>0){d.directoryPath=d.directoryPath.replace(/\/?$/,"/")}return d},getQueryParameters:function(a){a=a||document.location.search;return(!a&&{})||a.replace(/(^\?)/,"").split("&").map(function(b){return b=b.split("="),this[b[0]]=decodeURIComponent(b[1].replace(/\+/g," ")),this}.bind({}))[0]},geoLocate:function(g,d,b){var e={enableHighAccuracy:false,maximumAge:0,timeout:27000},f=jQuery.Deferred(),c=jQuery.extend({},e,b),a=this;if("geolocation" in navigator){navigator.geolocation.getCurrentPosition(function(j){var h=new usig.Location(j.coords.latitude,j.coords.longitude);f.resolve(h);if(typeof(g)=="function"){g(h)}},function(h){f.fail(h);if(typeof(d)=="function"){d(h)}},c)}else{return false}return f},registeredSuggesters:{},registeredSuggestersDesc:{},registerSuggester:function(a,b,c){usig.registeredSuggesters[a]=b;usig.registeredSuggestersDesc[a]=c},createSuggester:function(b,a){if(typeof(usig.registeredSuggesters[b])!="function"){throw"Suggester "+b+" is not registered.";return null}return new usig.registeredSuggesters[b](a)}});jQuery.expr[":"].Contains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};jQuery.expr[":"].ContainsFilter=function(c,d,b){if(c.innerHTML.indexOf("data-filter")>=0){var e=c.innerHTML.match(/data-filter\=\"(.*?)\"/)[1].toUpperCase().indexOf(b[3].toUpperCase())>=0}return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0||e};if(typeof(usig)=="undefined"){usig={}}usig.MapaInteractivo=(function(a){return function(T,t){var w=a.extend({},usig.MapaInteractivo.defaults,t),E=a("#"+T),o=parseInt(E.css("width")),M=parseInt(E.css("height")),x={},I={},C={},e=null,q=false,F=false,m=this,p=null,z=[],P=[],G=[],v=a('<div class="indicator" style="-moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px;"></div>'),y=null,g=null,B=null,b=null,R=null,Q=null,H=null,J=null,s=null,n=null;function O(){v.remove();w.OpenLayersOptions.maxExtent=new OpenLayers.Bounds(w.bounds[0],w.bounds[1],w.bounds[2],w.bounds[3]);w.OpenLayersOptions.initBounds=new OpenLayers.Bounds(w.initBounds[0],w.initBounds[1],w.initBounds[2],w.initBounds[3]);y=new OpenLayers.Map(T,w.OpenLayersOptions);a("div.olMapViewport",E).append(v);this.api=y;this.api.zoomToMaxExtent=function(W){this.zoomToExtent(w.OpenLayersOptions.initBounds)};b=new OpenLayers.Control.ScaleBar({minWidth:141,maxWidth:142});y.addControl(b);if(w.includePanZoomBar){B=new OpenLayers.Control.PanZoomBarUSIG({zoomBar:w.zoomBar});y.addControl(B)}if(w.includeToolbar){var V=a.extend({},w.texts.navBar,{clickHandler:w.onMapClick});if(!w.zoomBar){V.top=90}g=new OpenLayers.Control.NavToolbarUSIG(V);y.addControl(g);this.toolbar=g}else{y.addControl(new OpenLayers.Control.Navigation())}if(w.includeMapSwitcher){var U=a.extend({},w.MapSwitcherOptions,{onOptionToggle:(function(X,W){if(X=="markers-toggle"&&H){this.toggleLayer(H)}}).createDelegate(this),onMapSelection:(function(W){this.setBaseLayer(W)}).createDelegate(this)},w.mapSwitcher);this.mapSwitcher=new OpenLayers.Control.MapSelector(U);y.addControl(this.mapSwitcher)}Q=new OpenLayers.Control.StatusBar();y.addControl(Q);y.addControl(new OpenLayers.Control.MousePosition({formatOutput:function(W){return""}}));H=new OpenLayers.Layer.Vector("MyMarkers",{styleMap:new OpenLayers.StyleMap({"default":{externalGraphic:w.rootUrl+"images/marker-3.0.png",graphicWidth:32,graphicHeight:42,graphicXOffset:-16,graphicYOffset:-36,graphicZIndex:w.MARKER_Z_INDEX,cursor:"pointer"},select:{graphicWidth:38,graphicHeight:50,graphicXOffset:-19,graphicYOffset:-43}}),rendererOptions:{yOrdering:true}});y.addLayer(H);s=new OpenLayers.Control.SelectFeature([H],{hover:true,highlightOnly:true});J=new OpenLayers.Control.SelectFeature([H],{clickout:true,toggle:false,multiple:false,hover:false,toggleKey:"ctrlKey",multipleKey:"shiftKey"});n=OpenLayers.Class(OpenLayers.Popover.Anchored,{autoSize:true,panMapIfOutOfView:true,minSize:new OpenLayers.Size(100,70),maxSize:new OpenLayers.Size(340,550),displayClass:"popover"});H.events.on({featureselected:function(Z){var X=x[Z.feature.attributes.fid];var Y=X.feature;var W=null;if(X.place.options.popup){W=new n(Z.feature.id,new OpenLayers.LonLat(Z.feature.geometry.x,Z.feature.geometry.y),null,X.popupContent,null,false,function(){J.unselect(Y)});Z.feature.popup=W;W.hide();y.addPopup(W,true)}if(typeof(X.onClick)=="function"){X.onClick(Z,X.place,W,J)}else{if(W){W.show();W.updateSize()}}if(!W){J.unselect(Y)}},featureunselected:function(W){if(W.feature&&W.feature.popup){y.removePopup(W.feature.popup);W.feature.popup.destroy();W.feature.popup=null}}});y.addControl(s);y.addControl(J);s.activate();J.activate();if(w.initLocation){this.loadMap(w.initLocation.mapConfig)}else{this.setBaseLayer(w.baseLayer)}y.zoomToExtent(w.OpenLayersOptions.initBounds);if(w.initLocation){y.moveTo(new OpenLayers.LonLat(w.initLocation.lon,w.initLocation.lat),w.initLocation.zl)}else{y.zoomToExtent(w.OpenLayersOptions.initBounds)}if(typeof(w.onReady)=="function"){w.onReady(this)}v.hide()}function f(){var U=usig.MapaInteractivo.defaults.OpenLayersJS.replace("OpenLayers.js","");a.each(w.preloadImages,function(W,V){z.push(a('<img src="'+U+V+'"/>'))})}function k(U){var V=new Array();a.each(w.servers,function(W,X){V.push(X+U)});return V}function j(){var W=-1;if(navigator.appName=="Microsoft Internet Explorer"){var U=navigator.userAgent;var V=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(V.exec(U)!=null){W=parseFloat(RegExp.$1)}}return W<=8}this.setOptions=function(U){w=a.extend({},w,U)};this.updateSize=function(){(function(){y.updateSize();v.css("left",(parseInt(E.css("width"))/2-26)+"px");v.css("top",(parseInt(E.css("height"))/2-26)+"px")}).defer(200,this)};this.getMarkers=function(){return x};this.unselectFeature=function(U){J.unselect(U)};this.selectFeature=function(U){J.select(U)};this.setBaseLayer=function(V){var U=y.baseLayer;if(U==undefined){this.addWMSLayer(V,{isBaseLayer:true})}else{if(U.name!=V){try{y.removeLayer(U)}catch(W){}this.addWMSLayer(V,{isBaseLayer:true})}}};function u(V){var U={style:null,lonlat:null};if(V instanceof OpenLayers.Marker){U={style:{externalGraphic:V.icon.url,backgroundGraphic:w.rootUrl+"images/blank.gif",graphicWidth:V.icon.size.w,graphicHeight:V.icon.size.h,graphicXOffset:V.icon.offset.x,graphicYOffset:V.icon.offset.y},lonlat:V.lonlat.clone()};V.destroy();return U}if(V.options&&V.options.iconUrl){U={style:{externalGraphic:V.options.iconUrl,backgroundGraphic:V.options.backgroundGraphic||w.rootUrl+"images/blank.gif",graphicWidth:V.options.iconWidth,graphicHeight:V.options.iconHeight,backgroundWidth:V.options.iconWidth,backgroundHeight:V.options.iconHeight,graphicXOffset:V.options.offsetX,graphicYOffset:V.options.offsetY}}}if(V.x!=undefined&&V.y!=undefined){U.lonlat=new OpenLayers.LonLat(V.x,V.y)}if(usig.Direccion&&V instanceof usig.Direccion){U.lonlat=new OpenLayers.LonLat(V.getCoordenadas().x,V.getCoordenadas().y)}if(usig.inventario&&usig.inventario.Objeto&&V instanceof usig.inventario.Objeto){U.lonlat=new OpenLayers.LonLat(V.ubicacion.getCentroide().x,V.ubicacion.getCentroide().y)}return U}function N(){if(usig.NormalizadorDirecciones){q=false;if(usig.NormalizadorDirecciones.listo()){r()}else{usig.NormalizadorDirecciones.init({onReady:N.createDelegate(this),loadFullDatabase:true})}}else{if(!q){q=true;usig.loadJs(w.NormalizadorDireccionesJS,N.createDelegate(this))}}}function r(){var U=0;if(usig.NormalizadorDirecciones&&usig.NormalizadorDirecciones.listo()){a.each(I,function(Z,Y){try{var X=Y.place;var V=usig.NormalizadorDirecciones.normalizar(X,10);if(V.length>0){Y.place=V[0];C[Z]={place:Y.place,goTo:Y.goTo,onClick:Y.onClick,options:Y.options};U++}}catch(W){}delete I[Z]});if(U>0){D()}}else{N()}}function D(){if(e){a.each(C,function(W,V){var U=V.place;e.geoCodificarDireccion(U,function(X){V.place.setCoordenadas(X);A(V.place,W,V.goTo,V.onClick,V.options)});delete C[W]})}else{S()}}function S(){if(usig.GeoCoder){F=false;e=new usig.GeoCoder();D()}else{if(!F){F=true;usig.loadJs(w.GeoCoderJS,S.createDelegate(this))}}}function K(U,V){if(V){if(y.getZoom()==w.goToZoomLevel){y.panTo(new OpenLayers.LonLat(U.lon,U.lat))}else{y.moveTo(new OpenLayers.LonLat(U.lon,U.lat),w.goToZoomLevel)}}else{y.panTo(new OpenLayers.LonLat(U.lon,U.lat))}}function A(V,ab,Y,aa,W){var Z={instantPopup:false,popup:true};Q.activate(w.texts.processing,true);V.options=a.extend({},Z,W);if(typeof(aa)=="object"){V.options=a.extend({},Z,aa)}var U=u(V);var X=(V.toString()!="[object Object]"||typeof(V)=="string")?V:"Lon: "+U.lonlat.lon+", Lat: "+U.lonlat.lat;if(aa&&typeof(aa)!="function"&&typeof(aa)!="object"){X=aa}U.place=V;U.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(U.lonlat.lon,U.lonlat.lat),{fid:ab});U.feature.style=U.style;U.popupContent=X;U.onClick=typeof(aa)=="function"?aa:null;x[""+ab]=U;H.addFeatures(U.feature);if(Y){K(U.lonlat,true)}if(V.options&&V.options.instantPopup){J.select(U.feature)}Q.deactivate();return ab}function d(X){var U=X.getPlan();if(U instanceof Array){var V=usig.GMLPlan.create("trip_plan_"+X.getId(),{template:X.getTemplate(),baseUrl:w.rootUrl,tipoRecorrido:X.getTipo()});for(i=0;i<U.length;i++){var W=U[i];if(W.type!=undefined){if(W.type=="StartWalking"||W.type=="FinishWalking"){if(i==0){V.addMarker(W.gml.replace("walk","beginwalk"))}else{V.addMarker(W.gml)}}else{if(W.type=="Board"){if(i==0){V.addMarker(W.gml.replace(/(bus|subway|train)/g,"begin$1"))}else{if(W.service_type=="1"){switch(W.service){case"Línea A":W.gml=W.gml.replace("subway","subwayA");break;case"Línea B":W.gml=W.gml.replace("subway","subwayB");break;case"Línea C":W.gml=W.gml.replace("subway","subwayC");break;case"Línea D":W.gml=W.gml.replace("subway","subwayD");break;case"Línea E":W.gml=W.gml.replace("subway","subwayE");break;case"Línea H":W.gml=W.gml.replace("subway","subwayH");break}}V.addMarker(W.gml)}}else{if(W.type=="Bus"||W.type=="SubWay"||W.type=="Street"){V.addEdges([W.gml])}else{if(W.type=="SubWayConnection"){switch(W.service_to){case"Línea A":W.gml[1]=W.gml[1].replace("connection","subwayA");break;case"Línea B":W.gml[1]=W.gml[1].replace("connection","subwayB");break;case"Línea C":W.gml[1]=W.gml[1].replace("connection","subwayC");break;case"Línea D":W.gml[1]=W.gml[1].replace("connection","subwayD");break;case"Línea E":W.gml[1]=W.gml[1].replace("connection","subwayE");break;case"Línea H":W.gml[1]=W.gml[1].replace("connection","subwayH");break}V.addMarker(W.gml[1]);V.addEdges(W.gml)}else{if(W.type=="StartDriving"||W.type=="FinishDriving"){V.addMarker(W.gml)}else{if(W.type=="StartBiking"||W.type=="FinishBiking"){if(i==0){V.addMarker(W.gml.replace("bike","beginbike"))}else{V.addMarker(W.gml)}}}}}}}}}X.gmlLayer=V;return V}return false}function h(W){var V=y.getLayersByName(W.gmlLayer.name);if(V.length>0){for(l=0;l<V.length;l++){V[l].setVisibility(true)}}else{var U=W.gmlLayer;U.setVisibility(true);y.addLayer(U);y.setLayerZIndex(U,80)}y.zoomToExtent(W.gmlLayer.getDataExtent())}this.addMarker=function(U,X,Y,V){var W=Math.floor(Math.random()*100001);var Z=new Date()*1+W;if(typeof(U)=="string"){I[Z]={place:U,goTo:X,onClick:Y,options:V};r();return Z}return A(U,Z,X,Y,V)};this.removeMarker=function(W){var U=x[""+W];if(U){try{J.unselect(U.feature)}catch(V){}H.removeFeatures(U.feature)}U=undefined;x[W]=undefined;delete x[W]};this.toggleMarker=function(W,V){var U=x[""+W];if(V){H.getFeatureById(U.feature.id).style=U.style}else{H.getFeatureById(U.feature.id).style=a.extend({},U.style,{display:"none"})}H.redraw()};this.goToMarker=function(W,V){var U=x[""+W];K(U.lonlat,V)};this.goTo=function(U,V){K(U,V)};this.showStatus=function(V,U){Q.activate(V,U)};this.hideStatus=function(){Q.deactivate()};this.showIndicator=function(){v.show()};this.hideIndicator=function(){v.hide()};this.raiseMarkers=function(U){if(H){y.raiseLayer(H,U)}};this.getMarkersIndex=function(){return y.getLayerIndex(H)};this.getMarkersZIndex=function(){return H.getZIndex()};this.getMarker=function(U){return x[""+U]};this.getMarkersLayer=function(){return H};this.zoomToMarkers=function(){if(H.features.length>1){y.zoomToExtent(H.getDataExtent())}};this.mostrarRecorrido=function(U){if(!U.gmlLayer){U.getDetalle(function(){if(d(U)){h(U)}})}else{h(U)}};this.ocultarRecorrido=function(U){if(U.gmlLayer){U.gmlLayer.setVisibility(false)}};this.existeLayer=function(V){if(V.gmlLayer){var U=y.getLayersByName(V.gmlLayer.name);return(U.length>0)}return false};this.borrarRecorrido=function(U){if(U.gmlLayer){y.removeLayer(U.gmlLayer)}};function c(U){U.defaultStyle=a.extend({},U.defaultStyle,U.symbolizer);if(!U.selectStyle){U.selectStyle=a.extend({},U.defaultStyle);U.selectStyle.externalGraphic=undefined;U.selectStyle.backgroundGraphic=undefined;U.selectStyle.fillColor=undefined;U.selectStyle.strokeColor=undefined}var W=new OpenLayers.StyleMap({"default":U.defaultStyle,select:U.selectStyle});var V=new Array();a.each(U.escalas,function(Y,X){if(U.symbolizer.graphicWidth&&U.symbolizer.graphicHeight){X.symbolizer.graphicWidth=parseInt(Math.round(U.symbolizer.graphicWidth*X.symbolizer.size));X.symbolizer.graphicHeight=parseInt(Math.round(U.symbolizer.graphicHeight*X.symbolizer.size));if(U.symbolizer.backgroundWidth&&U.symbolizer.backgroundHeight){X.symbolizer.backgroundWidth=parseInt(Math.round(U.symbolizer.backgroundWidth*X.symbolizer.size));X.symbolizer.backgroundHeight=parseInt(Math.round(U.symbolizer.backgroundHeight*X.symbolizer.size))}}else{X.symbolizer.pointRadius=Math.max(parseInt(Math.round(U.selectStyle.pointRadius*X.symbolizer.size)),U.minPointRadius);X.symbolizer.strokeWidth=Math.max(parseInt(Math.round(U.selectStyle.strokeWidth*X.symbolizer.size)),U.minPointRadius);X.symbolizer.fontSize=Math.max(parseInt(Math.round(parseInt(U.selectStyle.fontSize)*X.symbolizer.size)),parseInt(U.minFontSize))+"px"}if(U.symbolizer.graphicXOffset&&U.symbolizer.graphicYOffset){X.symbolizer.graphicXOffset=parseInt(Math.round(U.symbolizer.graphicXOffset*X.symbolizer.size));X.symbolizer.graphicYOffset=parseInt(Math.round(U.symbolizer.graphicYOffset*X.symbolizer.size))}if(U.symbolizer.backgroundXOffset&&U.symbolizer.backgroundYOffset){X.symbolizer.backgroundXOffset=parseInt(Math.round(U.symbolizer.backgroundXOffset*X.symbolizer.size));X.symbolizer.backgroundYOffset=parseInt(Math.round(U.symbolizer.backgroundYOffset*X.symbolizer.size))}a.each(U.clases,function(Z,ab){if(!(ab.filter instanceof OpenLayers.Filter)){ab.filter=new OpenLayers.Filter.Comparison(ab.filter)}var aa=a.extend({},ab.symbolizer,X.symbolizer);if(!ab.symbolizer){aa.fillColor=U.colors[Z]}V.push(new OpenLayers.Rule(a.extend({},ab,X,{symbolizer:aa})))});V.push(new OpenLayers.Rule(a.extend({},X,{elseFilter:true})))});W.styles["default"].addRules(V);return W}this.addVectorLayer=function(V,U){var Y=a.extend(true,{},usig.MapaInteractivo.defaults.vectorLayer,U);if(Y.onClick&&!Y.symbolizer.cursor){Y.symbolizer.cursor="pointer"}var W=new OpenLayers.Layer.Vector(V,{styleMap:c(Y),visibility:Y.visible,minScale:Y.minScale,maxScale:Y.maxScale,rendererOptions:{yOrdering:false,zIndexing:true}});y.addLayer(W);this.raiseMarkers(y.layers.length);y.setLayerZIndex(W,Y.zIndex);if(Y.url&&Y.url!=""){this.showIndicator();var X=Y.format.toUpperCase()=="GML"?"xml":"json";a.ajax({url:Y.url,dataType:(window.location.host==usig.parseUri(Y.url).authority)||(usig.parseUri(Y.url).authority==Y.url)?X:"jsonp",success:(function(ac){if(Y.format.toUpperCase()=="GML"){var ab=new OpenLayers.Format.GML();W.addFeatures(ab.read(ac))}else{if(Y.format.toUpperCase()=="GEOJSON"){var aa=new OpenLayers.Format.GeoJSON();W.addFeatures(aa.read(ac))}}if(typeof(Y.onLoad)=="function"){Y.onLoad()}this.hideIndicator()}).createDelegate(this),error:function(aa){}})}if(Y.onClick&&!Y.disableClick){if(Y.highlightable){var Z=s.layers;Z.push(W);s.setLayer(Z)}var Z=J.layers;Z.push(W);J.setLayer(Z);W.events.on({featureselected:function(ac){var ab=ac.feature;ac.layerName=V;if(Y.popup){var aa=new n(ac.feature.id,y.getLonLatFromPixel(y.getControlsByClass("OpenLayers.Control.MousePosition")[0].lastXy),null,'<div id="contenido_'+ac.feature.id+'"></div>',null,false,function(ad){J.unselect(ab);ad.cancelBubble=true;return false});ac.feature.popup=aa;aa.hide();y.addPopup(aa,true)}if(typeof(Y.onClick)=="function"){Y.onClick(ac,aa)}else{if(aa){aa.show()}}if(!aa){J.unselect(ab)}},featureunselected:function(aa){if(aa.feature.popup){y.removePopup(aa.feature.popup);aa.feature.popup.destroy();aa.feature.popup=null}}})}return W};this.addWMSLayer=function(V,U){var X=a.extend({},usig.MapaInteractivo.defaults.wmsLayer,U);if(!X.layerUrls){X.layerUrls=k(V)}if(!X.layers){X.layers=V}var W=new OpenLayers.Layer.WMS(V,X.layerUrls,{layers:X.layers,format:X.format,transparent:X.transparent},{transitionEffect:X.transitionEffect,buffer:X.buffer,opacity:j()?1:X.opacity,singleTile:X.singleTile,isBaseLayer:X.isBaseLayer,minScale:X.minScale,maxScale:X.maxScale});y.addLayer(W);return W};this.addLayerToSelectControl=function(U){var V=J.layers;if(V.indexOf(U)<0){V.push(U);J.setLayer(V)}};this.removeLayer=function(U){try{y.removeLayer(U);var W=s.layers;W.removeObject(U);s.setLayer(W);W=J.layers;W.removeObject(U);J.setLayer(W);U.destroy()}catch(V){return V}return true};this.toggleLayer=function(V,U){if(typeof(U)=="undefined"){V.setVisibility(!V.visibility)}else{V.setVisibility(U)}};this.toggleMarkers=function(){this.toggleLayer(H)};this.loadMap=function(V){this.removeVectorLayers();this.removeWMSLayers();if(V.baseLayer){this.setBaseLayer(V.baseLayer)}if(V.layers){var U=this;a.each(V.layers,function(X,W){if(W.options.format.toUpperCase()=="WMS"){G.push(U.addWMSLayer(W.name,W.options))}else{if(W.options.popup==undefined){W.options.popup=V.popup}if(W.options.onClick==undefined){W.options.onClick=V.onClick}P.push(U.addVectorLayer(W.name,W.options))}})}};this.removeVectorLayers=function(){for(var V=0,U=P.length;V<U;V++){this.removeLayer(P[V])}P=[]};this.removeWMSLayers=function(){for(var V=0,U=G.length;V<U;V++){this.removeLayer(G[V])}G=[]};if(typeof(OpenLayers)=="undefined"){p=a('<img src="'+w.rootUrl+'images/animated_indicator_medium.gif" alt="'+w.texts.loading+'"/>');p.css("padding","10px");v.css("background-color","#fff").css("width","52px").css("height","52px").css("border","1px solid #ddd").css("position","relative").css("zIndex","1000").css("opacity","0.85").css("left",(o/2-26)+"px").css("top",(M/2-26)+"px").append(p);E.css("background-color","#eee").append(v);usig.loadCss(w.OpenLayersCSS);usig.loadJs(w.OpenLayersJS,O.createDelegate(this));(function(){if(typeof(OpenLayers)=="undefined"){f()}}).defer(500,this)}else{O.defer(200,this)}}})(jQuery);usig.MapaInteractivo.defaults={debug:false,includePanZoomBar:true,zoomBar:true,includeToolbar:true,includeMapSwitcher:false,bounds:[54340,54090,172855,140146],initBounds:[93500,96750,112000,106750],OpenLayersOptions:{controls:[],resolutions:[90,50,30,15,7.5,4,2,1,0.5,0.2],projection:"EPSG:221951",units:"m"},MapSwitcherOptions:{layers:[{name:"satellite",title:"vista satelital 2009",id:"mapabsas_imagen_satelital_2009"},{name:"default",title:"vista del mapa",id:"mapabsas_default3"}],opcionales:[{id:"markers-toggle",name:"Mostrar Mis Marcadores",checked:true}],mapas:[]},baseLayer:"mapabsas_informacion_basica",rootUrl:"//servicios.usig.buenosaires.gob.ar/usig-js/dev/",OpenLayersCSS:"//servicios.usig.buenosaires.gob.ar/OpenLayers/2.13-dev1-1/theme/default/style.css",OpenLayersJS:"//servicios.usig.buenosaires.gob.ar/OpenLayers/2.13-dev1-1/OpenLayers.js",NormalizadorDireccionesJS:"//servicios.usig.buenosaires.gob.ar/nd-js/1.4/normalizadorDirecciones.min.js",GeoCoderJS:"//servicios.usig.buenosaires.gob.ar/usig-js/3.2/usig.GeoCoder.min.js",preloadImages:[],texts:{processing:"Procesando...",loading:"Cargando...",tituloMailing:"Enviar vista actual por e-mail",mapSelectorDefault:"Vista del Plano",panZoomBar:{textAcercar:"Acercar",textAlejar:"Alejar",verMapaCompleto:"Ver el mapa completo"},overviewMap:{textMapaReferencia:"Mapa de referencia interactivo",textCerrar:"Cerrar"},navBar:{navigationText:"Mover",zoomBoxText:"Acercar",measureToolTexts:{buttonLabel:"Medir",measure:"Medida",measureDistance:"Medir Distancia",measureArea:"Medir Área"}}},vectorLayer:{format:"GML",highlightable:true,popup:false,visible:true,escalas:[{minScaleDenominator:80000,symbolizer:{size:0.4}},{minScaleDenominator:20000,maxScaleDenominator:80000,symbolizer:{size:0.5}},{maxScaleDenominator:20000,symbolizer:{size:0.7}}],clases:[],minPointRadius:3,minFontSize:"10px",symbolizer:{fillColor:"#0000ee",strokeColor:"#666666",strokeWidth:1,pointRadius:7,cursor:"pointer"},zIndex:0,colors:["#8F58C7","#E34900","#C3E401","#F9B528","#D71440","#007baf","#495a78","#b56c7d","#669966","#ff3300"]},wmsLayer:{format:"image/png",transitionEffect:"resize",buffer:0,opacity:1,singleTile:false,transparent:true,isBaseLayer:false,minScale:100000,maxScale:0},goToZoomLevel:7,SHADOW_Z_INDEX:10,MARKER_Z_INDEX:11,servers:["//tiles1.usig.buenosaires.gob.ar/tilecache/","//tiles2.usig.buenosaires.gob.ar/tilecache/","//tiles3.usig.buenosaires.gob.ar/tilecache/"]};if(typeof(usig)=="undefined"){usig={}}usig.GMLPlan=(function(b){var a;return{create:function(d,c){if(!OpenLayers){throw ("ERROR: OpenLayers is not loaded.");return null}if(!a){a=OpenLayers.Class(OpenLayers.Layer.Vector,{format:null,formatOptions:null,loaded:false,edges:null,markers:null,styleMap:null,rendererOptions:{zIndexing:true},initialize:function(g,f){var e=[];this.styleMap=this.getStyle(f.template,f.baseUrl,f.tipoRecorrido);e.push(g,{styleMap:this.styleMap});OpenLayers.Layer.Vector.prototype.initialize.apply(this,e);this.edges=new Array();this.markers=new Array()},loadFeatures:function(){var e={};OpenLayers.Util.extend(e,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){e.externalProjection=this.projection;e.internalProjection=this.map.getProjectionObject()}var f=this.format?new this.format(e):new OpenLayers.Format.GML(e);gml='<?xml version="1.0" encoding="utf-8"?><wfs:FeatureCollection xmlns:ms="http://mapserver.gis.umn.edu/mapserver" xmlns:wfs="http://www.opengis.net/wfs" xmlns:gml="http://www.opengis.net/gml">';gml+=this.edges.join();gml+=this.markers.join();gml+="</wfs:FeatureCollection>";this.loaded=true;this.addFeatures(f.read(gml));this.events.triggerEvent("loadend")},addMarker:function(e){this.markers.push("<gml:featureMember>"+e+"</gml:featureMember>")},addEdges:function(e){ls=this.edges;b.each(e,function(g,f){ls.push("<gml:featureMember>"+f+"</gml:featureMember>")})},setVisibility:function(e,f){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.events.triggerEvent("loadstart");this.loadFeatures()}},moveTo:function(g,e,f){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.events.triggerEvent("loadstart");this.loadFeatures()}},getFeatureByAttrId:function(h){var g=null;for(var f=0,e=this.features.length;f<e;++f){if(this.features[f].attributes.fid==h){g=this.features[f];break}}return g},highlightFeature:function(e){this.drawFeature(e,this.styleMap.styles.select)},setStyle:function(e){this.styleMap=e},getStyle:function(f,g,e){defaultOpacity=0.8;zIndexLine=8;zIndexPoint=9;zIndexMarker=14;lineOptions={strokeWidth:5,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};lineOptionsWalk={strokeWidth:4,strokeDashstyle:"dashdot",strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};color=f.color;styleMap=new OpenLayers.StyleMap(OpenLayers.Util.applyDefaults({fillColor:color,fillOpacity:1,strokeColor:color,strokeWidth:3,strokeOpacity:1},OpenLayers.Feature.Vector.style["default"]));if(e=="transporte_publico"){var h={beginwalk:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},walk:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_pie20x20.png",graphicZIndex:zIndexPoint},Line:lineOptionsWalk},beginbus:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/colectivo.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},bus:{Point:{pointRadius:12,externalGraphic:g+"images/recorrido_colectivo20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptions},subway:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_subte20x20.png",graphicZIndex:zIndexPoint},Line:lineOptions},beginsubway:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/subte.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},subwayA:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-a.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayB:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-b.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayC:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-c.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayD:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-d.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayE:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-e.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayH:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-h.png",graphicZIndex:zIndexPoint},Line:lineOptions},connection:{Point:{pointRadius:6,graphicZIndex:zIndexPoint},Line:{strokeWidth:8,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine}},train:{Point:{pointRadius:12,externalGraphic:g+"images/recorrido_tren20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptions},begintrain:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/tren.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="walk"){var h={beginwalk:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},walk:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="car"){var h={car:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/auto.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptions},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="bike"){walkColor=color;bikeColor=color;pointRadius=4;lineOptionsBike={strokeWidth:3,strokeColor:bikeColor,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};lineOptionsWalk={strokeWidth:4,strokeColor:walkColor,strokeDashstyle:"dashdot",strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};var h={walk:{Point:{graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_pie20x20.png",graphicZIndex:zIndexPoint},Line:lineOptionsWalk},bike:{Point:{externalGraphic:g+"images/recorrido_bici20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptionsBike},"Carril preferencial":{Point:{pointRadius:pointRadius,fillColor:bikeColor,strokeColor:bikeColor,graphicWidth:35,graphicHeight:35,graphicZIndex:zIndexPoint},Line:lineOptionsBike},"Ciclovía":{Point:{pointRadius:pointRadius,fillColor:bikeColor,strokeColor:bikeColor,graphicWidth:35,graphicHeight:35,graphicZIndex:zIndexPoint},Line:lineOptionsBike},beginwalk:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},beginbike:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/bici.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsBike},end:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}}}}styleMap.addUniqueValueRules("default","type",h);return styleMap},CLASS_NAME:"usig.GMLPlan"})}return new a(d,c)}}})(jQuery);