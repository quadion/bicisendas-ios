jQuery.extendIf=function(b,d){if(b&&d){for(var a in d){if(typeof b[a]=="undefined"){b[a]=d[a]}}}return b};if(typeof(Ext)=="undefined"){jQuery.extend(Function.prototype,{createCallback:function(){var a=arguments;var b=this;return function(){return b.apply(window,a)}},createDelegate:function(c,b,a){var d=this;return function(){var f=b||arguments;if(a===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(b)}else{if(typeof a=="number"){f=Array.prototype.slice.call(arguments,0);var e=[a,0].concat(b);Array.prototype.splice.apply(f,e)}}return d.apply(c||window,f)}},defer:function(c,e,b,a){var d=this.createDelegate(e,b,a);if(c){return setTimeout(d,c)}d();return 0},createSequence:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){var d=c.apply(this||window,arguments);b.apply(a||this||window,arguments);return d}},createInterceptor:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){b.target=this;b.method=c;if(b.apply(a||this||window,arguments)===false){return}return c.apply(this||window,arguments)}}});jQuery.extendIf(String,{escape:function(a){return a.replace(/('|\\)/g,"\\$1")},leftPad:function(d,b,c){var a=new String(d);if(!c){c=" "}while(a.length<b){a=c+a}return a.toString()},format:function(b){var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}})}String.prototype.isInteger=function(){return !isNaN(parseInt(this))};String.prototype.isFloat=function(){return !isNaN(parseFloat(this))};String.prototype.toggle=function(b,a){return this==b?a:b};String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return this.replace(a,"")}}();String.prototype.translate=function(d,c){if(!(d.length&&c.length)||d.length!=c.length){return this}var b=this;for(var a=0;a<d.length;a++){if(typeof(d)=="string"){b=b.replace(new RegExp(d.charAt(a),"g"),c.charAt(a))}else{b=b.replace(new RegExp(d[a],"g"),c[a])}}return b};String.prototype.isDigit=function(){return/^\d+$/.test(this)};String.prototype.removeWords=function(e){var d=this.split(" ");var c=new Array();for(var b=0;b<d.length;b++){c.push(d[b]);for(var a=0;a<e.length;a++){if(c[b]==e[a]){c.pop();break}}}return c.join(" ")};jQuery.extendIf(Number.prototype,{constrain:function(b,a){return Math.min(Math.max(this,b),a)},isInteger:function(){return !isNaN(parseInt(this))},isFloat:function(){return !isNaN(parseFloat(this))}});jQuery.extendIf(Array.prototype,{indexOf:function(c){for(var b=0,a=this.length;b<a;b++){if(this[b]==c){return b}}return -1},removeObject:function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}return this},binarySearch:function binarySearch(f,b){var a=0,e=this.length-1,c,d;while(a<=e){c=parseInt((a+e)/2,10);d=b(this[c],f);if(d<0){a=c+1;continue}if(d>0){e=c-1;continue}return c}return -1},inject:function(c,b){for(var a=0;a<this.length;a++){c=b(c,this[a],a)}return c},map:function(d,c){var a=new Array(this.length);for(var b=0,e=this.length;b<e;b++){if(b in this){a[b]=d.call(c,this[b],b,this)}}return a},intersect:function(){if(!arguments.length){return[]}var e=this;var d=a2=null;var h=0;while(h<arguments.length){d=[];a2=arguments[h];var c=e.length;var b=a2.length;for(var g=0;g<c;g++){for(var f=0;f<b;f++){if(e[g]===a2[f]){d.push(e[g])}}}e=d;h++}return d.unique()},unique:function(){var c=[];var b=this.length;for(var e=0;e<b;e++){for(var d=e+1;d<b;d++){if(this[e]===this[d]){d=++e}}c.push(this[e])}return c}});Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())};if(typeof(usig)=="undefined"){usig={}}usig.debug=function(a){if(window.console&&window.console.log){window.console.log(a)}};if(typeof(usig)=="undefined"){usig={}}usig.Location=function(b,a,c){this.lat=b;this.lng=a;this.desc=c;this.toString=function(){return this.desc||"Ubicación actual"};this.getCoordenadas=function(){return new usig.Punto(this.lng,this.lat)};this.setLatLng=function(e,d){this.lat=e;this.lng=d};this.getLatLng=function(){if(L&&L.latLng){return L.latLng(this.lat,this.lng)}else{return this.getCoordenadas()}}};jQuery.extendIf(usig,{loadingJs:[],loadingJsListeners:{},__callLoadJsListeners:function(b){for(var c=0,a=usig.loadingJsListeners[b].length;c<a;c++){usig.loadingJsListeners[b][c]()}},loadJs:function(b,e){if(usig.loadingJs.indexOf(b)<0){usig.loadingJs.push(b);usig.loadingJsListeners[b]=(typeof(e)=="function")?[e]:[];var a=document.createElement("script"),c=document.getElementsByTagName("head")[0],d=false;a.onload=a.onreadystatechange=function(){if((a.readyState&&a.readyState!=="complete"&&a.readyState!=="loaded")||d){return false}a.onload=a.onreadystatechange=null;d=true;usig.__callLoadJsListeners(b)};a.src=b;c.insertBefore(a,c.firstChild)}else{usig.loadingJsListeners[b].push(e)}},loadCss:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);if(typeof b!="undefined"){document.getElementsByTagName("head")[0].appendChild(b)}},removeJs:function(a){var c=document.getElementsByTagName("script");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("src")!=null&&c[b].getAttribute("src").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},removeCss:function(a){var c=document.getElementsByTagName("link");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("href")!=null&&c[b].getAttribute("href").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},Animator:function(c,d,e,f){var b=0;function a(){if(c.length>b){d(c[b]);b++;setTimeout(a,e)}else{if(typeof(f)=="function"){f()}}}this.stop=function(){b=c.length+1};a()},parseUri:function(e){var a=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],b=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),d={};for(var c=0;c<10;c++){d[a[c]]=(b[c]?b[c]:"")}if(d.directoryPath.length>0){d.directoryPath=d.directoryPath.replace(/\/?$/,"/")}return d},getQueryParameters:function(a){a=a||document.location.search;return(!a&&{})||a.replace(/(^\?)/,"").split("&").map(function(b){return b=b.split("="),this[b[0]]=decodeURIComponent(b[1].replace(/\+/g," ")),this}.bind({}))[0]},geoLocate:function(g,d,b){var e={enableHighAccuracy:false,maximumAge:0,timeout:27000},f=jQuery.Deferred(),c=jQuery.extend({},e,b),a=this;if("geolocation" in navigator){navigator.geolocation.getCurrentPosition(function(j){var h=new usig.Location(j.coords.latitude,j.coords.longitude);f.resolve(h);if(typeof(g)=="function"){g(h)}},function(h){f.fail(h);if(typeof(d)=="function"){d(h)}},c)}else{return false}return f},registeredSuggesters:{},registeredSuggestersDesc:{},registerSuggester:function(a,b,c){usig.registeredSuggesters[a]=b;usig.registeredSuggestersDesc[a]=c},createSuggester:function(b,a){if(typeof(usig.registeredSuggesters[b])!="function"){throw"Suggester "+b+" is not registered.";return null}return new usig.registeredSuggesters[b](a)}});jQuery.expr[":"].Contains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};jQuery.expr[":"].ContainsFilter=function(c,d,b){if(c.innerHTML.indexOf("data-filter")>=0){var e=c.innerHTML.match(/data-filter\=\"(.*?)\"/)[1].toUpperCase().indexOf(b[3].toUpperCase())>=0}return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0||e};(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;jQuery.Class=function(){};jQuery.Class.create=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,j){return function(){var l=this._super;this._super=f[h];var k=j.apply(this,arguments);this._super=l;return k}})(d,g[d]):g[d]}function c(){if(!a&&c.prototype.init){return c.prototype.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();if(typeof(usig)=="undefined"){usig={}}usig.AjaxComponent=(function(a){return jQuery.Class.create({init:function(e,b,d){this.name=e;var c=d.dataType||(window.location.host==usig.parseUri(b).authority?"json":"jsonp");this.defaultParams={type:"GET",url:b,dataType:c};this.opts=a.extend({},usig.AjaxComponent.defaults,d);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") dataType: "+c)}},mkRequest:function(g,l,j,d){var c=null,h=0,n=a.Deferred();function b(o,p){clearTimeout(c);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success")}if(typeof(this.opts.afterServerResponse)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse")}this.opts.afterServerResponse()}p(o);n.resolve(o)}function f(o,p){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error")}if(h>=this.opts.maxRetries){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Max Errors Reached")}clearTimeout(c);if(typeof(p)=="function"){p(o)}n.reject(o)}else{if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error. Retrying... ("+h+")")}}}function k(o,q){if(o!=null&&o.readyState!=0&&o.readyState!=4){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Aborting request...")}o.abort();if(typeof(this.opts.afterAbort)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort")}this.opts.afterAbort()}if(this.opts.maxRetries>h){h++;var p=a.ajax(q);if(typeof(this.opts.afterRetry)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry")}this.opts.afterRetry()}if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Retrying request... ("+h+")")}c=setTimeout(k.createDelegate(this,[p,m]),this.opts.serverTimeout)}else{if(this.opts.debug){usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito.")}if(typeof(q.error)=="function"){q.error("Se produjo un error al intentar acceder al servidor: "+q.url)}}}}if(typeof(l)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una función que acepte como parámetro el dato solicitado porque puede no estar inmediatamente disponible.")}return}if(typeof(j)!="undefined"&&typeof(j)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una función.")}return}var m=a.extend(true,{},this.defaultParams,{success:b.createDelegate(this,[l],1),error:f.createDelegate(this,[j],1),data:g});if(d){m.url=d}var e=a.ajax(m);if(this.opts.debug){usig.debug(m.dataType+" request...")}if(typeof(this.opts.afterServerRequest)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest")}this.opts.afterServerRequest()}if(this.opts.serverTimeout>0){c=setTimeout(k.createDelegate(this,[e,m]),this.opts.serverTimeout)}return n},setOptions:function(b){this.opts=a.extend({},this.opts,b)},getOptions:function(){return this.opts}})})(jQuery);usig.AjaxComponent.defaults={debug:false,serverTimeout:30000,maxRetries:1};if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.defaults)=="undefined"){usig.defaults={}}usig.TripTemplate=function(b,a){this.index=b;this.color=a;this.cls="trip_"+b};usig.defaults.Recorridos={debug:false,server:"//recorridos.usig.buenosaires.gob.ar/2.0/",searchApi:"consultar_gba",serverTimeout:30000,maxRetries:1,lang:"es",consultaRecorridos:{tipo:"transporte",gml:true,precargar:3,opciones_caminata:800,opciones_medios_colectivo:true,opciones_medios_subte:true,opciones_medios_tren:true,opciones_prioridad:"avenidas",opciones_incluir_autopistas:true,opciones_cortes:true,max_results:10},colorTemplates:[new usig.TripTemplate(0,"#0074FF"),new usig.TripTemplate(1,"#DD0083"),new usig.TripTemplate(2,"#009866"),new usig.TripTemplate(3,"#FF9E29"),new usig.TripTemplate(4,"#FF6633"),new usig.TripTemplate(5,"#5B3BA1"),new usig.TripTemplate(6,"#98C93C"),new usig.TripTemplate(7,"#EE3A39"),new usig.TripTemplate(8,"#4ED5F9"),new usig.TripTemplate(9,"#FFCC05"),new usig.TripTemplate(10,"#84004F"),new usig.TripTemplate(11,"#00A5EB"),new usig.TripTemplate(12,"#016406"),new usig.TripTemplate(13,"#AB62D2"),new usig.TripTemplate(14,"#C49F25"),new usig.TripTemplate(15,"#9F2510"),new usig.TripTemplate(16,"#0003CF"),new usig.TripTemplate(17,"#CBA4FA"),new usig.TripTemplate(18,"#00FFC9"),new usig.TripTemplate(19,"#DC6767")]};usig.Recorridos=(function(a){return new (usig.AjaxComponent.extend({lastRequest:null,init:function(b){var c=a.extend({},usig.defaults.Recorridos,b);c.consultaRecorridos=a.extend({},usig.defaults.Recorridos.consultaRecorridos,b);this._super("Recorridos",usig.defaults.Recorridos.server,c);return this},getUbicacion:function(b){var c={coordenadas:{x:0,y:0},codigo_calle:0,altura:0,codigo_calle2:0};if(b.x!=undefined&&b.y!=undefined){c.coordenadas=b}if(usig.Direccion&&b instanceof usig.Direccion){if(b.getTipo()==usig.Direccion.CALLE_Y_CALLE){c.codigo_calle2=b.getCalleCruce().codigo}c.coordenadas=b.getCoordenadas();c.codigo_calle=b.getCalle().codigo;c.altura=b.getAltura()}if(usig.inventario&&usig.inventario.Objeto&&b instanceof usig.inventario.Objeto){if(b.direccionAsociada){c.coordenadas=b.direccionAsociada.getCoordenadas();c.codigo_calle=b.direccionAsociada.getCalle().codigo;c.altura=b.direccionAsociada.getAltura()}else{c.coordenadas=b.ubicacion.getCentroide()}}if(usig.DireccionMapabsas&&b instanceof usig.DireccionMapabsas){if(b.tipo==usig.Direccion.CALLE_Y_CALLE){c.codigo_calle2=b.cod_calle_cruce}c.codigo_calle=b.cod;c.altura=b.alt}return c},_expandirOrigenDestino:function(c,b){var d={},e=this.getUbicacion(c);if(e.coordenadas){d.origen=e.coordenadas.x+","+e.coordenadas.y}d.origen_calles2=e.codigo_calle2;d.origen_calles=e.codigo_calle;d.origen_calle_altura=e.altura;var f=this.getUbicacion(b);if(f.coordenadas){d.destino=f.coordenadas.x+","+f.coordenadas.y}d.destino_calles2=f.codigo_calle2;d.destino_calles=f.codigo_calle;d.destino_calle_altura=f.altura;return d},onBuscarRecorridosSuccess:function(f,h,e,d){var b=[],c=this.opts.colorTemplates,g=this.opts.lang;if(this.opts.debug){usig.debug("usig.Recorridos onBuscarRecorridosSuccess")}a.each(f.planning,function(k,l){var j=JSON.parse(l);switch(j.type){case"car":template=c[1];break;case"bike":template=c[0];break;case"walk":template=c[2];break;case"transporte_publico":template=c[k];break}b.push(new usig.Recorrido(JSON.parse(l),{template:template,lang:g},e,d))});if(typeof(h)=="function"){h(b)}},loadTripPlan:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"load_plan")},consultarRecorridos:function(d,c,e,b){this.lastRequest=this.mkRequest(d,e,b,this.opts.server+"recorridos_"+c)},InfoTransporte:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"info_transporte/")},buscarRecorridos:function(f,e,h,d,c){var b={};if(f&&e){b=this._expandirOrigenDestino(f,e)}var g=a.extend({},this.opts.consultaRecorridos,c,b);this.lastRequest=this.mkRequest(g,this.onBuscarRecorridosSuccess.createDelegate(this,[h,f,e],1),d,this.opts.server+this.opts.searchApi)},cargarPlanRecorrido:function(j,h,d,c,f,e){var b={};if(f&&e){b=this._expandirOrigenDestino(f,e)}var g=a.extend({},this.opts.consultaRecorridos,c,b);g.trip_id=j;g.tipo="loadplan";this.lastRequest=this.mkRequest(g,h,d,this.opts.server+this.opts.searchApi)},transportesCercanos:function(e,f,c){var b=this.getUbicacion(e);var d={x:b.coordenadas.x,y:b.coordenadas.y};this.lastRequest=this.mkRequest(d,f,c,this.opts.server+"info_transporte/")},cicloviasCercanas:function(f,g,d,c){var b=this.getUbicacion(f);var e={lon:b.coordenadas.x,lat:b.coordenadas.y};if(c){if(c.radio){e.radio=c.radio}if(c.cantidad){e.cantidad=c.cantidad}}this.lastRequest=this.mkRequest(e,g,d,this.opts.server+"ciclovias_cercanas/")}}))})(jQuery);if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.Recorrido)=="undefined"){usig.Recorrido=(function(a){return function(y,j,w,A){var x=0,h=0,q,F,C,n,f,l,e,E,t,k="Sin datos",G="Sin datos",z=[],m=[],g=0,s=a.extend({},usig.Recorrido.defaults,j);getServiceIcon=function(H){var I="";if(H==0){I="recorrido_pie"}if(H==1){I="recorrido_subte"}if(H==2){I="recorrido_tren"}if(H==3){I="recorrido_colectivo"}if(H==4){I="recorrido_bici"}return'<img src="'+s.icons[I]+'" width="20" height="20">'};function B(){var H=[];G="";if(f=="transporte_publico"){estadoAnterior=null;a.each(l,function(I,K){if(K.type=="Board"){if(estadoAnterior=="Alight"){G+='<span class="icons-sprite icon-combinacion"></span>'}if(K.service_type==3){G+='<div class="pill colectivo'+K.service+'"><div class="primero"><span class="segundo"></span></div> <span class="linea">'+K.service+"</span></div>";H.push(K.service)}else{if(K.service_type==1){lineas=K.service.split("-");a.each(lineas,function(M,N){G+='<div class="circlePill subte'+N+'"><span class="linea">'+N.replace("Premetro","P")+"</span></div>"});H.push(K.service)}else{if(K.service_type==2){var J=K.long_name?K.long_name:K.service;G+='<div class="pill trenpill"><div class="primero"><span class="segundo"></span></div> <span class="linea" title="'+J+'">'+K.service.replace(/\./g,"")+"</span></div>";H.push(K.service)}}}if(K.alertas){a.each(K.alertas,function(M,N){if(N.idioma.toLowerCase()==s.lang.toLowerCase()){m.push({mensaje:N.mensaje,service:N.service})}})}}estadoAnterior=K.type});k=H.join(", ")}else{if(f=="walk"){k=s.texts.descWalk;a.each(l,function(I,J){if(J.type!=undefined&&J.type=="StartWalking"){G+='<span class="icon-walk"></span><span class="descripcion">'+k+"</span>"}})}else{if(f=="car"){k=s.texts.descCar;a.each(l,function(I,J){if(J.type!=undefined&&J.type=="StartDriving"){G+='<span class="icon-car"></span><span class="descripcion">'+k+"</span>"}})}else{if(f=="bike"){k=s.texts.descBike;a.each(l,function(I,J){if(J.type!=undefined&&J.type=="StartBiking"){G+='<span class="icon-bike"></span><span class="descripcion">'+k+"</span>";return false}});if(G==""){G+='<span class="icon-walk"></span>'}}}}}}function v(){if(f=="transporte_publico"){var H=null;var Q=false;var Z=0;var T=null;var R=null;var J=new Array();var X=new Array();var K=usig.Recorrido.defaults.texts.planTransporte;for(i=0;i<e.length;i++){var V=e[i];if(V.type!=undefined){if(V.type=="StartWalking"){Q=true;if(i==0){H=K.walking["startDir"].texto.replace("$calle",e[i+1].name);H=H.replace("$desde",e[i+1].from)}else{if(e[i-1].calle2!=null){H=K.walking["startCruce"].texto.replace("$calle1",e[i-1].calle1);H=H.replace("$calle2",e[i-1].calle2)}else{H=K.walking["startDir"].texto.replace("$calle",e[i-1].calle1);H=H.replace("$desde","")}}R="pie"}else{if(V.type=="FinishWalking"){if(H){H+=K.walking["finish"].texto;z.push({text:H,type:R,features:J});H=null;R=null;J=[]}Q=false}else{if(V.type=="Board"){var N=Q;if(Q){if(V.service_type=="3"){if(V.calle2!=null){H+=K.board["walking_esquina"].texto}else{H+=K.board["walking_calle_nro"].texto}}else{H+=K.board["walkingestacion"].texto.replace("$estacion",V.stop_name)}H=H.replace("$calle1",V.calle1);H=H.replace("$calle2",V.calle2);H=H.replace("$nro","");if(!(H.charAt(H.length-1)==".")){H+="."}z.push({text:H,type:R,features:J});Q=false;H=null;R=null;J=[]}if(V.service_type=="1"){H=K.board["subte"].texto;if(Z>0){H+=K.board["estacion"].texto}R="subte"}else{if(V.service_type=="3"){if(V.trip_description&&V.trip_description!=""&&!V.any_trip){T=K.board["ramales"].texto.replace("$ramal",V.trip_description.replace(/\$/g,", "))}else{T=(!V.any_trip)?" ("+s.texts.hayRamales+")":""}H=K.board["colectivo"].texto;if(V.metrobus){H+=K.board["estacion"].texto}R="colectivo"}else{if(V.service_type=="2"){if(V.trip_description!=""){T=" ("+V.trip_description.replace(/\$/g,", ")+")"}else{T=(!V.any_trip)?" ("+s.texts.hayRamales+")":""}H=K.board["tren"].texto;R="tren";if(Z>0){H+=K.board["estacion"].texto}}}}if(!N){if(V.calle2!=null){H+=K.board["esquina"].texto}else{if(V.calle1!=null){H+=K.board["calle_nro"].texto}}if(Z<=0&&V.stop_name!=null){H+=K.board["estacion"].texto}}Z+=1;H=H.replace("$calle1",V.calle1);H=H.replace("$calle2",V.calle2);H=H.replace("$nro","");H=H.replace("$estacion",V.stop_name);H=H.replace("$colectivo",V.service);H=H.replace("$tren",V.service.toUpperCase());H=H.replace("$subte",V.service.toUpperCase().replace("LÍNEA",""));H=H.replace("$ramal",T);H=H.replace("$sentido",V.trip_description)}else{if(V.type=="Alight"){if(V.service_type!=undefined&&(V.service_type=="2"||V.service_type=="1")){H+=K.alight["subtetren"].texto}else{if(V.metrobus){H+=K.alight["metrobus"].texto}else{if(V.calle2!=null){H+=K.alight["cole_esquina"].texto}else{H+=K.alight["cole_calle_nro"].texto}}}H=H.replace("$calle1",V.calle1);H=H.replace("$calle2",V.calle2);H=H.replace("$nro","");H=H.replace("$estacion",V.stop_name);if(!(H.charAt(H.length-1)==".")){H+="."}z.push({text:H,type:R,features:J});H=null;R=null;J=[]}else{if(V.type=="Bus"&&V.gml){J.push(V.gml)}else{if(V.type=="SubWay"&&V.gml){if(J.length==0){J.push(V.gml)}else{var U=J[J.length-1];if(U.search("gml:LineString")>=0&&U.search("subway")>=0){var W=V.gml}else{J.push(V.gml)}}}else{if(V.type=="SubWayConnection"){z.push({text:H,type:R,features:J});H=K.subwayconnection.texto;H=H.replace("$estacionorigen",V.stop_from);H=H.replace("$estaciondestino",V.stop);H=H.replace("$subte",V.service_to.toUpperCase().replace("LÍNEA",""));H=H.replace("$sentido",V.trip_description);R="subte";J=[];J.push(W)}else{if(V.type=="Street"&&V.gml){J.push(V.gml)}}}}}}}}}}}else{if(f=="walk"){var O=new Array();var M=0;for(i=0;i<e.length;i++){var V=e[i];if(V.type!=undefined){var P=null;if(V.type=="Street"){M++;P=V.name+" ";if(typeof(V.from)!="undefined"){P+=V.from}if(typeof(V.to)!="undefined"){P+=" - "+V.to}O.push({type:"walk",text:P,distance:V.distance,index:M,id:V.id})}}}z=O}else{if(f=="car"){O=new Array();M=0;var P;var Y=usig.Recorrido.defaults.texts.planAuto;for(i=0;i<e.length;i++){var V=e[i];if(V.type!=undefined){var S;if(V.type=="Street"){M++;if(V.indicacion_giro!="0"&&V.indicacion_giro!="1"&&V.indicacion_giro!="2"){P=Y.irDesde.texto;S="seguir"}else{if(V.indicacion_giro=="0"){P=Y.seguir.texto;S="seguir"}else{if(V.indicacion_giro=="1"){P=Y.doblarIzq.texto;S="izquierda"}else{if(V.indicacion_giro=="2"){P=Y.doblarDer.texto;S="derecha"}}}}if(V.from){P=P.replace("$desde",V.from)}else{P=P.replace("$desde","")}if(V.to){P+=Y.hasta.texto.replace("$hasta",V.to)}P=P.replace(/\$calle/g,V.name);O.push({text:P,turn_indication:S,index:M,distance:V.distance,type:"car",id:V.id})}}}z=O}else{if(f=="bike"){var Q=false;O=new Array();var M=0;var P;var I=usig.Recorrido.defaults.texts.planBici;for(i=0;i<e.length;i++){var V=e[i];if(V.type!=undefined){if(V.type=="StartWalking"){Q=true}else{if(V.type=="FinishWalking"){Q=false}else{if(V.type=="Street"){if(V.indicacion_giro!="0"&&V.indicacion_giro!="1"&&V.indicacion_giro!="2"){if(Q){P=I.inicio["walking"].texto}else{P=I.inicio["biking"].texto}S="seguir"}else{P=I[Q?"walking":"biking"][V.indicacion_giro].texto;S=I[Q?"walking":"biking"][V.indicacion_giro].turn_indication}if(V.tipo=="Ciclovía"){P=P.replace("$via",I.ciclovia.texto)}else{if(V.tipo=="Carril preferencial"){P=P.replace("$via",I.carril.texto)}else{P=P.replace("$via","")}}if(V.to==0||V.from==0||V.to==null||V.from==null){P=P.replace("$metros",V.distance+" m ")}else{P=P.replace("$metros","")}if(V.from){P=P.replace("$desde",V.from)}else{P=P.replace("$desde","")}if(V.to){P+=I.hasta.texto.replace("$hasta",V.to)}P=P.replace(/\$calle/g,V.name);modo=Q?"walk":"bike";O.push({text:P,turn_indication:S,modo:modo,index:M,distance:V.distance,type:"bike",id:V.id})}}}}}z=O}}}}}function b(H){try{x=H.id;h=H.tiempo;q=H.origen;C=H.destino;f=H.type;l=H.summary;g=H.traveled_distance;E=a.extend({},H);E.options=s;B();r(H)}catch(I){usig.debug(I)}}function r(H,I){if(!e&&H.plan){e=H.plan;E.plan=H.plan;v()}if(typeof(I)=="function"){I(z,e)}}function u(H){return a(H).find("gml-coordinates").text().split(" ").map(function(I){return I.split(",").map(function(J){return parseFloat(J)})})}function o(H){var I=[];a(H).find("gml-lineStringMember").each(function(K,J){I.push(u(J))});return I}function p(H,I){a.each(I,function(K,J){H.features.push({type:"Feature",properties:{gml_id:null,type:a(this).find("gml-type").text(),fid:null},geometry:{type:"MultiLineString",coordinates:o(J)}})})}function D(H,I){a.each(I,function(K,J){H.features.push({type:"Feature",properties:{gml_id:null,type:a(this).find("gml-type").text(),fid:null},geometry:{type:"LineString",coordinates:u(J)}})})}function d(H,I){if(I instanceof Array){I=I[0]}var J=a.parseXML(I.replace(/:/g,"-"));if(a(J).find("gml-feature:has(gml-MultiLineString)").length>0){p(H,a(J).find("gml-feature:has(gml-MultiLineString)"))}else{D(H,a(J).find("gml-feature:has(gml-LineString)"))}}function c(H,I){var K=a(a.parseXML(I.replace(/:/g,"-")));if(K.find("gml-Point")){var J=K.find("gml-coordinates").text().split(",");H.features.push({type:"Feature",properties:{gml_id:null,type:K.find("gml-type").text(),fid:null},geometry:{type:"Point",coordinates:[parseFloat(J[0]),parseFloat(J[1])]}})}else{usig.debug(K)}}this.getGeoJson=function(){if(this.geoJson){return this.geoJson}var H=this.getPlan();if(H instanceof Array){var J={type:"FeatureCollection",features:[]};for(i=0;i<H.length;i++){var I=H[i];if(I.type!=undefined){if(I.type=="StartWalking"||I.type=="FinishWalking"){if(i==0){c(J,I.gml.replace("walk","beginwalk"))}else{c(J,I.gml)}}else{if(I.type=="Board"){if(i==0){c(J,I.gml.replace(/(bus|subway|train)/g,"begin$1"))}else{if(I.service_type=="1"){switch(I.service){case"Línea A":if(I.gml.indexOf("subwayA")<0){I.gml=I.gml.replace("subway","subwayA")}break;case"Línea B":if(I.gml.indexOf("subwayB")<0){I.gml=I.gml.replace("subway","subwayB")}break;case"Línea C":if(I.gml.indexOf("subwayC")<0){I.gml=I.gml.replace("subway","subwayC")}break;case"Línea D":if(I.gml.indexOf("subwayD")<0){I.gml=I.gml.replace("subway","subwayD")}break;case"Línea E":if(I.gml.indexOf("subwayE")<0){I.gml=I.gml.replace("subway","subwayE")}break;case"Línea H":if(I.gml.indexOf("subwayH")<0){I.gml=I.gml.replace("subway","subwayH")}break}}c(J,I.gml)}}else{if(I.type=="Alight"){if((I.service_type=="2"||I.service_type=="3")&&I.gml){c(J,I.gml)}}else{if(I.type=="Bus"||I.type=="SubWay"||I.type=="Street"){d(J,I.gml)}else{if(I.type=="SubWayConnection"){switch(I.service_to){case"Línea A":I.gml[1]=I.gml[1].replace("connection","subwayA");break;case"Línea B":I.gml[1]=I.gml[1].replace("connection","subwayB");break;case"Línea C":I.gml[1]=I.gml[1].replace("connection","subwayC");break;case"Línea D":I.gml[1]=I.gml[1].replace("connection","subwayD");break;case"Línea E":I.gml[1]=I.gml[1].replace("connection","subwayE");break;case"Línea H":I.gml[1]=I.gml[1].replace("connection","subwayH");break}c(J,I.gml[1]);d(J,I.gml)}else{if(I.type=="StartDriving"||I.type=="FinishDriving"){c(J,I.gml)}else{if(I.type=="StartBiking"||I.type=="FinishBiking"){if(i==0){c(J,I.gml.replace("bike","beginbike"))}else{c(J,I.gml)}}}}}}}}}}this.geoJson=J;return J}return false};this.load=function(H){b(H)};this.toString=function(){return k};this.toHtmlString=function(){return G};this.getTime=function(){return h};this.getTraveledDistance=function(){return g};this.getTimeString=function(){time="";if(h>60){hs=Math.floor(h/60);mins=h%60;time+=hs+(hs>1?"hs ":"h ")+mins+" '"}else{time+=h+" '"}return time};this.getDistanceString=function(){distance="";if(g>999){distance+=((g/1000).toFixed(2)+" Km").replace(".",",")}else{distance+=g+" m"}return distance};this.getPlan=function(I,H,J){if(!e){usig.Recorridos.cargarPlanRecorrido(x,r.createDelegate(this,[I],1),H,J)}else{if(typeof(I)=="function"){I(e)}}return e};this.getDetalle=function(I,H,J){if(!e){if(E.plan){r(E,I)}else{usig.Recorridos.cargarPlanRecorrido(x,r.createDelegate(this,[I],1),H,J,F,n)}}else{if(typeof(I)=="function"){I(z)}}};this.getId=function(){return x};this.getTemplate=function(){return s.template};this.getColor=function(){return s.template.color};this.getTipo=function(){return f};this.setColor=function(H){s.template.color=H};this.getCoordenadaOrigen=function(){return q};this.getCoordenadaDestino=function(){return C};this.toJson=function(){return E};this.isEqual=function(H){return f==H.getTipo()&&k==H.toString()&&w==H.getCoordenadaOrigen()&&A==H.getCoordenadaDestino()};this.getAlertas=function(){return m};this.setLanguage=function(H){if(usig.Recorrido.texts[H]){usig.Recorrido.defaults.texts=usig.Recorrido.texts[H]}s=a.extend({},usig.Recorrido.defaults,s)};this.setLanguage(s.lang||"es");F=w;n=A;if(y){b(y)}}})(jQuery);usig.Recorrido.fromObj=function(a){return new usig.Recorrido(a,a.options)};usig.Recorrido.defaults={icons:{recorrido_pie:"//mapa.buenosaires.gob.ar/images/recorrido_pie20x20.png",recorrido_subte:"//mapa.buenosaires.gob.ar/images/recorrido_subte20x20.png",recorrido_tren:"//mapa.buenosaires.gob.ar/images/recorrido_tren20x20.png",recorrido_colectivo:"//mapa.buenosaires.gob.ar/images/recorrido_colectivo20x20.png",recorrido_auto:"//mapa.buenosaires.gob.ar/images/recorrido_auto20x20.png",recorrido_bici:"//servicios.usig.buenosaires.gob.ar/usig-js/dev/images/recorrido_bici20x20.png"},template:new usig.TripTemplate(1,"#8F58C7")};usig.Recorrido.texts={}}usig.Recorrido.texts.es={descWalk:"Recorrido a pie",descCar:"Recorrido en auto",descBike:"Recorrido en bici",hayRamales:"No todos los ramales conducen a destino",planTransporte:{walking:{startDir:{texto:'Caminar desde <span class="plan-calle">$calle $desde</span>'},startCruce:{texto:'Caminar desde <span class="plan-calle">$calle1 y $calle2</span>'},finish:{texto:" hasta destino."}},board:{walking_esquina:{texto:' hasta <span class="plan-calle">$calle1 y $calle2</span>'},walking_calle_nro:{texto:' hasta <span class="plan-calle">$calle1 $nro </span>'},walkingestacion:{texto:' hasta la estación <span class="plan-estacion">$estacion</span> en <span class="plan-calle">$calle1 y $calle2</span>'},subte:{texto:'Tomar el <span class="transport">SUBTE LÍNEA $subte (en dirección a $sentido)</span>'},estacion:{texto:' en la estación <span class="plan-estacion">$estacion</span>'},esquina:{texto:' en <span class="plan-calle">$calle1 y $calle2</span>'},calle_nro:{texto:' en <span class="plan-calle">$calle1 $nro</span>'},ramales:{texto:"(Ramales: $ramal)"},colectivo:{texto:'Tomar el <span class="transport">COLECTIVO $colectivo $ramal</span>'},tren:{texto:'Tomar el <span class="transport">TREN $tren $ramal</span>'}},alight:{subtetren:{texto:' y bajar en la estación <span class="plan-estacion">$estacion</span>'},cole_esquina:{texto:' y bajar en <span class="plan-calle">$calle1 y $calle2</span>'},cole_calle_nro:{texto:' y bajar en <span class="plan-calle">$calle1 $nro</span>'},metrobus:{texto:' y bajar en la estación <span class="plan-estacion">$estacion</span> en <span class="plan-calle">$calle1 y $calle2</span>'}},subwayconnection:{texto:'Bajarse en la estación <span class="plan-estacion">$estacionorigen</span> y combinar con el <span class="transport">SUBTE LÍNEA $subte (en dirección a $sentido)</span> en estación <span class="plan-estacion">$estaciondestino</span>'},},planAuto:{seguir:{texto:'Seguir por <span class="plan-calle">$calle</span>'},doblarIzq:{texto:'Doblar a la izquierda en <span class="plan-calle">$calle</span>'},doblarDer:{texto:'Doblar a la derecha en <span class="plan-calle">$calle</span>'},irDesde:{texto:'Ir desde <span class="plan-calle">$calle</span>'},hasta:{texto:' hasta el <span class="plan-calle">$hasta</span>'}},planBici:{inicio:{walking:{texto:'Caminar $metros desde <span class="plan-calle">$calle</span>'},biking:{texto:'Pedalear $metros desde $via<span class="plan-calle">$calle</span>'}},walking:[{texto:'Caminar $metros por <span class="plan-calle">$calle</span>',turn_indication:"seguir"},{texto:'Doblar a la izquierda en <span class="plan-calle">$calle</span> y caminar $metros',turn_indication:"izquierda"},{texto:'Doblar a la derecha en <span class="plan-calle">$calle</span> y caminar $metros',turn_indication:"derecha"}],biking:[{texto:'Seguir $metros por $via<span class="plan-calle">$calle</span>',turn_indication:"seguir"},{texto:'Doblar a la izquierda en $via<span class="plan-calle">$calle</span> y seguir $metros',turn_indication:"izquierda"},{texto:'Doblar a la derecha en $via<span class="plan-calle">$calle</span> y seguir $metros',turn_indication:"derecha"}],hasta:{texto:' hasta el <span class="plan-calle">$hasta</span>'},ciclovia:{texto:" ciclovia "},carril:{texto:" carril preferencial "}}};usig.Recorrido.texts.en={descWalk:"Walking directions",descCar:"Driving directions",descBike:"Bicycle directions",hayRamales:"Beware that not all routes go to destination",planTransporte:{walking:{startDir:{texto:'Walk from <span class="plan-calle">$desde $calle</span>'},startCruce:{texto:'Walk from intersection of <span class="plan-calle">$calle1 and $calle2</span>'},finish:{texto:" until reach your destination."}},board:{walking_esquina:{texto:' up to intersection of <span class="plan-calle">$calle1 and $calle2</span>'},walking_calle_nro:{texto:' up to <span class="plan-calle">$nro $calle1</span>'},walkingestacion:{texto:' up to the <span class="plan-estacion">$estacion station</span> at intersection of <span class="plan-calle">$calle1 and $calle2</span>'},subte:{texto:'Take the <span class="transport">$subte Subway Line (heading $sentido)</span>'},estacion:{texto:' at <span class="plan-estacion">$estacion station</span>'},esquina:{texto:' at intersection of <span class="plan-calle">$calle1 and $calle2</span>'},calle_nro:{texto:' at <span class="plan-calle">$nro $calle1</span>'},ramales:{texto:"(Ramales: $ramal)"},colectivo:{texto:'Take the <span class="transport">Bus $colectivo $ramal</span>'},tren:{texto:'Take the <span class="transport">$tren $ramal Train </span>'}},alight:{subtetren:{texto:' and exit at <span class="plan-estacion">$estacion station</span>'},cole_esquina:{texto:' get off at <span class="plan-calle">$calle1 and $calle2</span>'},cole_calle_nro:{texto:' get off at <span class="plan-calle">$nro $calle1</span>'},metrobus:{texto:' get off at <span class="plan-estacion">$estacion station</span> at <span class="plan-calle">$calle1 and $calle2</span>'}},subwayconnection:{texto:'Get off at <span class="plan-estacion">$estacionorigen station</span> and transfer to the <span class="transport">$subte  Subway Line  (heading $sentido)</span> at <span class="plan-estacion">$estaciondestino</span> station'},},planAuto:{seguir:{texto:'Continue forward onto <span class="plan-calle">$calle</span>'},doblarIzq:{texto:'Turn left onto <span class="plan-calle">$calle</span>'},doblarDer:{texto:'Turn right onto <span class="plan-calle">$calle</span>'},irDesde:{texto:'Start out on <span class="plan-calle">$calle</span>'},hasta:{texto:' up to <span class="plan-calle">$hasta $calle</span>'}},planBici:{inicio:{walking:{texto:'Walk $metros from <span class="plan-calle">$calle</span>'},biking:{texto:'Start out riding $metros on <span class="plan-calle">$calle</span>$via'}},walking:[{texto:'Walk $metros from <span class="plan-calle">$calle</span>',turn_indication:"seguir"},{texto:'Turn left onto <span class="plan-calle">$calle</span> and walk $metros',turn_indication:"izquierda"},{texto:'Turn right onto <span class="plan-calle">$calle</span> and walk $metros',turn_indication:"derecha"}],biking:[{texto:'Continue $metros through <span class="plan-calle">$calle</span>$via',turn_indication:"seguir"},{texto:'Turn left onto <span class="plan-calle">$calle</span>$via and continue $metros',turn_indication:"izquierda"},{texto:'Turn right onto <span class="plan-calle">$calle</span>$via and continue $metros',turn_indication:"derecha"}],hasta:{texto:' up to <span class="plan-calle">$hasta $calle</span>'},ciclovia:{texto:" bike lane "},carril:{texto:" bike lane "}}};