if(typeof(usig)=="undefined"){usig={}}usig.AjaxComponent=(function(a){return jQuery.Class.create({init:function(e,b,d){this.name=e;var c=d.dataType||(window.location.host==usig.parseUri(b).authority?"json":"jsonp");this.defaultParams={type:"GET",url:b,dataType:c};this.opts=a.extend({},usig.AjaxComponent.defaults,d);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") dataType: "+c)}},mkRequest:function(g,k,i,d){var c=null,h=0,m=a.Deferred();function b(n,o){clearTimeout(c);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success")}if(typeof(this.opts.afterServerResponse)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse")}this.opts.afterServerResponse()}o(n);m.resolve(n)}function f(n,o){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error")}if(h>=this.opts.maxRetries){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Max Errors Reached")}clearTimeout(c);if(typeof(o)=="function"){o(n)}m.reject(n)}else{if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error. Retrying... ("+h+")")}}}function j(n,p){if(n!=null&&n.readyState!=0&&n.readyState!=4){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Aborting request...")}n.abort();if(typeof(this.opts.afterAbort)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort")}this.opts.afterAbort()}if(this.opts.maxRetries>h){h++;var o=a.ajax(p);if(typeof(this.opts.afterRetry)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry")}this.opts.afterRetry()}if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Retrying request... ("+h+")")}c=setTimeout(j.createDelegate(this,[o,l]),this.opts.serverTimeout)}else{if(this.opts.debug){usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito.")}if(typeof(p.error)=="function"){p.error("Se produjo un error al intentar acceder al servidor: "+p.url)}}}}if(typeof(k)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una función que acepte como parámetro el dato solicitado porque puede no estar inmediatamente disponible.")}return}if(typeof(i)!="undefined"&&typeof(i)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una función.")}return}var l=a.extend(true,{},this.defaultParams,{success:b.createDelegate(this,[k],1),error:f.createDelegate(this,[i],1),data:g});if(d){l.url=d}var e=a.ajax(l);if(this.opts.debug){usig.debug(l.dataType+" request...")}if(typeof(this.opts.afterServerRequest)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest")}this.opts.afterServerRequest()}if(this.opts.serverTimeout>0){c=setTimeout(j.createDelegate(this,[e,l]),this.opts.serverTimeout)}return m},setOptions:function(b){this.opts=a.extend({},this.opts,b)},getOptions:function(){return this.opts}})})(jQuery);usig.AjaxComponent.defaults={debug:false,serverTimeout:30000,maxRetries:1};if(typeof(usig)=="undefined"){usig={}}usig.Inventario=(function(a){return usig.AjaxComponent.extend({lastRequest:null,init:function(b){var c=a.extend({},usig.Inventario.defaults,b);this._super("Inventario",usig.Inventario.defaults.server,c)},getCategorias:function(c,b){this.lastRequest=this.mkRequest({},c,b,this.opts.server+"getCategorias/")},getParcelaPorDir:function(c,d,b){this.lastRequest=this.mkRequest({cod_calle:c.cod,altura:c.alt},d,b,this.opts.server+"getParcela/")},getDir:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"getDir/")},getParcela:function(d,c,e,b){this.lastRequest=this.mkRequest(d,e,b,this.opts.server+"getParcela"+c+"/")},getDatosTransporte:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"getDatosTransporte/")},buscar:function(i,h,c,b){var e=a.extend({},this.opts.searchOptions,b),f={start:e.start,limit:e.limit,texto:i,tipo:e.tipoBusqueda,totalFull:e.totalFull};function d(j,m){var l={},k=[];a.each(j.clasesEncontradas,function(n,o){l[o.id]=new usig.inventario.Clase(o.id,o.nombre,o.nombreId,o.nombreNorm)});a.each(j.instancias,function(n,o){k.push(new usig.inventario.Objeto(o,l[o.claseId]))});if(typeof(m)=="function"){m(k)}}if(e.categoria!=undefined){f.categoria=e.categoria}if(e.clase!=undefined){f.clase=e.clase}if(e.bbox){f.bbox=[e.extent.left,e.extent.bottom,e.extent.right,e.extent.top].join(",")}var g=d.createDelegate(this,[h],1);if(e.returnRawData){g=h}this.lastRequest=this.mkRequest(f,g,c,this.opts.server+"buscar/")},getObjeto:function(d,e,b){function c(g,i,h){if(h instanceof usig.inventario.Objeto){if(this.opts.debug){usig.debug("Completando el objeto recibido")}h.fill(g);i(h)}else{if(this.opts.debug){usig.debug("Creando objeto nuevo")}i(new usig.inventario.Objeto(g))}}var f=typeof(d)=="object"?d.id:d;if(typeof(f)=="string"){this.lastRequest=this.mkRequest({id:f,srid:this.opts.searchOptions.srid},c.createDelegate(this,[e,d],1),b,this.opts.server+"getObjectContent/")}else{f=parseInt(f);if(f>0){this.lastRequest=this.mkRequest({id:f,srid:this.opts.searchOptions.srid},c.createDelegate(this,[e,d],1),b,this.opts.server+"getObjectContent/")}}},getFeatureInfo:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"getObjectContent/")},getCloseFeatures:function(c,d,b){this.lastRequest=this.mkRequest(c,d,b,this.opts.server+"objetosCercanos/")},getGeom:function(b,d,c){this.lastRequest=this.mkRequest({id:b},d,c,this.opts.server+"getGeometria/")},abort:function(){if(this.lastRequest){if(this.opts.debug){usig.debug("Inventario: aborting last request.")}this.lastRequest.fail();this.lastRequest=null;if(typeof(this.opts.afterAbort)=="function"){this.opts.afterAbort()}}else{if(this.opts.debug){usig.debug("Inventario: abort failed. Too late!")}}}})})(jQuery);usig.Inventario.defaults={debug:false,server:"//epok.buenosaires.gob.ar/",dataType:"jsonp",searchOptions:{start:0,limit:20,tipoBusqueda:"ranking",categoria:undefined,clase:undefined,bbox:false,totalFull:false,extent:undefined,returnRawData:false,srid:4326}};if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.inventario)=="undefined"){usig.inventario={}}usig.inventario.Objeto=(function(a){return function(b,c){this.id=0;this.nombre=usig.inventario.Objeto.defaults.texts.noName;this.ubicacion=null;this.clase=c;this.direccionAsociada=null;this.fechaAlta=null;this.fechaUltimaModificacion=null;this.datos={};this.rawData={};this.descripcion=null;if(c!=undefined){this.descripcion=c.getNombre()}this.fill=function(d){if(d.id){this.id=d.id}if(d.nombre){this.nombre=d.nombre}if(d.ubicacion){this.ubicacion=new usig.inventario.Ubicacion(d.ubicacion);this.rawData.ubicacion=d.ubicacion}if(d.fechaAlta){this.fechaAlta=new Date(d.fechaAlta);this.rawData.fechaAlta=d.fechaAlta}if(d.fechaUltimaModificacion){this.fechaUltimaModificacion=new Date(d.fechaUltimaModificacion);this.rawData.fechaUltimaModificacion=d.fechaUltimaModificacion}if(d.direccionAsociada){try{this.direccionAsociada=usig.Direccion.fromObj(d.direccionAsociada);this.rawData.direccionAsociada=d.direccionAsociada}catch(f){}}else{if(d.direccionNormalizada&&usig.NormalizadorDirecciones){try{this.direccionAsociada=usig.NormalizadorDirecciones.normalizar(d.direccionNormalizada,10,true)[0];this.direccionAsociada.setCoordenadas(this.ubicacion.getCentroide());if(d.smp){this.direccionAsociada.setSmp(d.smp)}this.rawData.direccionAsociada=this.direccionAsociada.toJson()}catch(f){usig.debug(f)}}}if(d.contenido){var g=this.datos;a.each(d.contenido,function(h,e){g[e.nombreId]={alias:e.nombre,valor:e.valor,pos:e.posicion}});if(this.datos.nombre){this.nombre=this.datos.nombre.valor}}this.rawData=a.extend(this.rawData,d)};this.toString=function(){return this.nombre};this.getRawData=function(){return this.rawData};this.clone=function(){var d=new usig.inventario.Objeto(b,c);return a.extend(true,d,this)};this.toJson=function(){var d=this.getRawData();if(this.clase&&this.clase.toJson){d.clase=this.clase.toJson()}if(this.direccionAsociada&&this.direccionAsociada.toJson){d.direccionAsociada=this.direccionAsociada.toJson()}return d};this.isEqual=function(d){return d instanceof usig.inventario.Objeto&&d.id==this.id};this.getSmp=function(){return this.rawData.smp||(this.direccionAsociada?this.direccionAsociada.getSmp():"")};this.getCoordenadas=function(){if(this.ubicacion){return this.ubicacion.getCentroide()}else{if(this.direccionAsociada){return this.direccionAsociada.getCoordenadas()}}};this.setCoordenadas=function(d){this.ubicacion=new usig.inventario.Ubicacion(d)};this.fill(b);this.rawData=a.extend(this.rawData,b)}})(jQuery);usig.inventario.Objeto.fromObj=function(a){return new usig.inventario.Objeto(a,usig.inventario.Clase.fromObj(a.clase))};usig.inventario.Objeto.defaults={texts:{noName:"Sin Nombre"}};if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.inventario)=="undefined"){usig.inventario={}}usig.inventario.Clase=function(d,c,b,a){this.getId=function(){return d};this.getNombre=function(){return c};this.getNombreId=function(){return b};this.getNombreNormalizado=function(){return a};this.toJson=function(){return{id:d,nombre:c,nombreId:b,nombreNormalizado:a}}};usig.inventario.Clase.fromObj=function(a){return new usig.inventario.Clase(a.id,a.nombre,a.nombreId,a.nombreNormalizado)};if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.inventario)=="undefined"){usig.inventario={}}usig.inventario.Ubicacion=function(c){var d=null,b,a=c.tipo;if(c instanceof usig.Punto){d=c}else{if(c.centroide!=undefined){d=usig.Punto.fromWkt(c.centroide)}}if(c.geometry!=undefined){b=c.geometry}this.getCentroide=function(){return d};this.getGeometry=function(){return b};this.getTipo=function(){return a}};if(typeof(usig)=="undefined"){usig={}}usig.SuggesterLugares=(function(a){return usig.Suggester.extend({init:function(b){if(b!=undefined){var c=a.extend({},usig.SuggesterLugares.defaults.searchOptions,b.searchOptions);b.searchOpts=c}var d=a.extend({},usig.SuggesterLugares.defaults,b);this._super("Lugares",d);if(!this.opts.inventario){this.opts.inventario=new usig.Inventario(d);this.cleanList.push(this.opts.inventario)}if(d.onReady&&typeof(d.onReady)=="function"){d.onReady()}},getSuggestions:function(d,f,e){var b=e!=undefined?e:this.opts.maxSuggestions;try{this.opts.inventario.buscar(d,f,function(){},{limit:b})}catch(c){f(c)}},getGeoCoding:function(b,c){if(!(b instanceof usig.inventario.Objeto)){c(new usig.Suggester.GeoCodingTypeError())}else{this.opts.inventario.getObjeto(b,function(d){if(d.direccionAsociada){c(d.direccionAsociada.getCoordenadas())}else{if(d.ubicacion){c(d.ubicacion.getCentroide())}}},function(){})}},abort:function(){this.opts.inventario.abort()},ready:function(){return true},setOptions:function(b){this._super(b);this.opts.inventario.setOptions(b)}})})(jQuery);usig.SuggesterLugares.defaults={serverTimeout:30000,maxRetries:1,maxSuggestions:10,searchOptions:{start:0,limit:20,tipoBusqueda:"ranking",categoria:undefined,clase:undefined,bbox:false,extent:undefined,returnRawData:false,srid:4326}};usig.registerSuggester("Lugares",usig.SuggesterLugares,"Permite buscar lugares de interés en la Ciudad de Buenos Aires y el área metropolitana");