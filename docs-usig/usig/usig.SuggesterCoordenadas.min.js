if(typeof(usig)=="undefined"){usig={}}usig.AjaxComponent=(function(b){return jQuery.Class.create({init:function(f,c,e){this.name=f;var d=e.dataType||(window.location.host==usig.parseUri(c).authority?"json":"jsonp");this.defaultParams={type:"GET",url:c,dataType:d};this.opts=b.extend({},usig.AjaxComponent.defaults,e);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") dataType: "+d)}},mkRequest:function(h,l,j,e){var d=null,i=0,n=b.Deferred();function c(o,p){clearTimeout(d);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success")}if(typeof(this.opts.afterServerResponse)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse")}this.opts.afterServerResponse()}p(o);n.resolve(o)}function g(o,p){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error")}if(i>=this.opts.maxRetries){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Max Errors Reached")}clearTimeout(d);if(typeof(p)=="function"){p(o)}n.reject(o)}else{if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error. Retrying... ("+i+")")}}}function k(o,q){if(o!=null&&o.readyState!=0&&o.readyState!=4){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Aborting request...")}o.abort();if(typeof(this.opts.afterAbort)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort")}this.opts.afterAbort()}if(this.opts.maxRetries>i){i++;var p=b.ajax(q);if(typeof(this.opts.afterRetry)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry")}this.opts.afterRetry()}if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Retrying request... ("+i+")")}d=setTimeout(k.createDelegate(this,[p,m]),this.opts.serverTimeout)}else{if(this.opts.debug){usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito.")}if(typeof(q.error)=="function"){q.error("Se produjo un error al intentar acceder al servidor: "+q.url)}}}}if(typeof(l)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una función que acepte como parámetro el dato solicitado porque puede no estar inmediatamente disponible.")}return}if(typeof(j)!="undefined"&&typeof(j)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una función.")}return}var m=b.extend(true,{},this.defaultParams,{success:c.createDelegate(this,[l],1),error:g.createDelegate(this,[j],1),data:h});if(e){m.url=e}var f=b.ajax(m);if(this.opts.debug){usig.debug(m.dataType+" request...")}if(typeof(this.opts.afterServerRequest)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest")}this.opts.afterServerRequest()}if(this.opts.serverTimeout>0){d=setTimeout(k.createDelegate(this,[f,m]),this.opts.serverTimeout)}return n},setOptions:function(c){this.opts=b.extend({},this.opts,c)},getOptions:function(){return this.opts}})})(jQuery);usig.AjaxComponent.defaults={debug:false,serverTimeout:30000,maxRetries:1};if(typeof(usig)=="undefined"){usig={}}usig.Punto=function(c,b){this.x=this.lon=c;this.y=this.lat=b;this.getX=function(){return this.x};this.getY=function(){return this.y};this.toJson=function(){return'{ "x":'+this.x+', "y": '+this.y+" }"};this.toString=function(){return"("+this.x+", "+this.y+")"}};usig.Punto.fromWkt=function(c){var d=/^POINT *\((-?[0-9]+\.[0-9]+) (-?[0-9]+\.[0-9]+)\)$/;var b=null;if(resMatch=c.match(d)){b=new usig.Punto(resMatch[1],resMatch[2])}return b};usig.Punto.fromPunto=function(b){return new usig.Punto(b.getX(),b.getY())};usig.Punto.fromObj=function(b){return new usig.Punto(b.x,b.y)};usig.Punto.fromArray=function(b){return new usig.Punto(b[0],b[1])};if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.Calle)=="undefined"){usig.Calle=function(b,c,e,d){this.codigo=b;this.nombre=c;this.alturaValida=function(g){if(e instanceof Array){if(e.length==0){throw (new usig.ErrorCalleSinAlturas(this.nombre));return false}var f=false;for(a in e){f=f||((parseInt(e[a][0])<=parseInt(g))&&(parseInt(e[a][1])>=parseInt(g)))}return f}};this.getTramos=function(){return e};this.toString=function(){return this.nombre};this.seCruzaCon=function(f){if(d){return d.indexOf(f.codigo)>=0}};this.toJson=function(){return{codigo:this.codigo,nombre:this.nombre}};this.isEqual=function(f){return this.codigo==f.codigo};this.setPartido=function(f){this.partido=f||"Ciudad Autónoma de Buenos Aires"};this.setLocalidad=function(f){this.localidad=f||""}};usig.Calle.fromObj=function(b){var d=new usig.Calle(b.codigo||b.cod_calle,b.nombre||b.calle||b.nombre_calle);d.setPartido(b.nombre_partido);d.setLocalidad(b.nombre_localidad);return d}}if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.Direccion)=="undefined"){usig.Direccion=(function(b){return function(c,g){var f=null;var j=null;var i=0;var e=null;var h="";var d=null;if(c instanceof usig.Calle){f=c}else{return null}if(g instanceof usig.Calle){j=g;e=usig.Direccion.CALLE_Y_CALLE}else{if(!isNaN(parseInt(g))){e=usig.Direccion.CALLE_ALTURA;i=parseInt(g)}else{return null}}this.getCalle=function(){return f};this.getCalleCruce=function(){if(e==usig.Direccion.CALLE_Y_CALLE){return j}else{return null}};this.getAltura=function(){return i};this.getTipo=function(){return e};this.toString=function(){if(e==usig.Direccion.CALLE_ALTURA){res=f.toString()+" "+(i>0?i:"S/N")}else{var k=j.nombre;var l=k.match(/^(I|Hi|HI).*/)?" e ":" y ";res=f.nombre+l+j.nombre}if(f.partido!=undefined){res=res+", "+f.localidad}return res};this.setCoordenadas=function(k){d=usig.Punto.fromPunto(k)};this.setSmp=function(k){h=k};this.getCoordenadas=function(){return d};this.getSmp=function(){return h};this.clone=function(){var k=new usig.Direccion(f,g);return b.extend(true,k,this)};this.toJson=function(){return{tipo:e,calle:f.toJson(),altura:i,calle_cruce:j?j.toJson():null,smp:h,coordenadas:d}};this.isEqual=function(k){var l=(k instanceof usig.Direccion&&(e==k.getTipo())&&((e==usig.Direccion.CALLE_ALTURA&&f.isEqual(k.getCalle())&&i==k.getAltura())||(e==usig.Direccion.CALLE_Y_CALLE&&((f.isEqual(k.getCalle())&&j.isEqual(k.getCalleCruce()))||(f.isEqual(k.getCalleCruce())&&j.isEqual(k.getCalle()))))));return l}}})(jQuery);usig.Direccion.CALLE_ALTURA=0;usig.Direccion.CALLE_Y_CALLE=1;usig.Direccion.fromObj=function(e){var b=null;if(e.tipo!=undefined&&e.calle&&e.calle.codigo){b=new usig.Direccion(usig.Calle.fromObj(e.calle),(e.tipo==usig.Direccion.CALLE_ALTURA)?e.altura:usig.Calle.fromObj(e.calle_cruce))}else{var d=usig.Calle.fromObj(e);if(e.cod_calle2||e.cod_calle_cruce){var c=new usig.Calle(e.cod_calle2||e.cod_calle_cruce,e.calle2||e.nombre_calle_cruce);c.setPartido(e.nombre_partido);c.setLocalidad(e.nombre_localidad);b=new usig.Direccion(d,c)}else{b=new usig.Direccion(d,e.altura)}if(e.nombre_partido){b.descripcion=e.nombre_localidad+", "+e.nombre_partido}}if(e.smp!=undefined&&e.smp!=null){b.setSmp(e.smp)}if(e.coordenadas!=undefined&&e.coordenadas!=null){if(typeof(e.coordenadas)=="string"){b.setCoordenadas(usig.Punto.fromWkt(e.coordenadas))}else{b.setCoordenadas(usig.Punto.fromObj(e.coordenadas))}}return b}}if(typeof(usig)=="undefined"){usig={}}usig.GeoCoder=(function(b){return usig.AjaxComponent.extend({metodos:["interpolacion","puertas","centroide"],init:function(c){var d=b.extend({},usig.GeoCoder.defaults,c);this._normalizadorCaba=usig.NormalizadorDirecciones.init({aceptarCallesSinAlturas:false,callesEnMinusculas:true});this._super("GeoCoder",usig.GeoCoder.defaults.server,d)},validarMetodo:function(c){if(c!=undefined){if(this.metodos.indexOf(c)>=0){return c}}else{if(this.opts.metodo!=undefined){return this.opts.metodo}}return undefined},onSuccess:function(c,d){if(typeof(c)!="string"){d(new usig.Punto(c.x,c.y))}else{d(c)}},geoCodificarDireccion:function(d,f,c,e){if(!(d instanceof usig.Direccion)){throw ("dir debe ser una instancia de usig.Direccion");return}if(d.getTipo()==usig.Direccion.CALLE_ALTURA){this.geoCodificarCodigoDeCalleAltura(d.getCalle().codigo,d.getAltura(),f,c,e)}else{this.geoCodificar2CodigosDeCalle(d.getCalle().codigo,d.getCalleCruce().codigo,f,c)}},geoCodificarCalleAltura:function(f,h,g,c,d){if(!h.isInteger()){throw ("altura tiene que ser un entero");return}var e={cod_calle:f,altura:h};d=this.validarMetodo(d);if(d!=undefined){e.metodo=d}this.mkRequest(e,this.onSuccess.createDelegate(this,[g],1),c,this.opts.server+"geocoding/")},geoCodificarCodigoDeCalleAltura:function(e,h,g,c,d){if(!e.isInteger()){throw ("codCalle tiene que ser un entero");return}if(!h.isInteger()){throw ("altura tiene que ser un entero");return}var f={cod_calle:e,altura:h};d=this.validarMetodo(d);if(d!=undefined){f.metodo=d}this.mkRequest(f,this.onSuccess.createDelegate(this,[g],1),c,this.opts.server+"geocoding/")},geoCodificarCalleYCalle:function(d,c,g,e){var f={cod_calle1:d,cod_calle2:c};this.mkRequest(f,this.onSuccess.createDelegate(this,[g],1),e,this.opts.server+"geocoding/")},geoCodificar2CodigosDeCalle:function(g,e,f,c){if(!g.isInteger()){throw ("codCalle1 tiene que ser un entero");return}if(!e.isInteger()){throw ("codCalle2 tiene que ser un entero");return}var d={cod_calle1:g,cod_calle2:e};this.mkRequest(d,this.onSuccess.createDelegate(this,[f],1),c,this.opts.server+"geocoding/")},reverseGeoCoding:function(c,g,f,d){var e={x:c,y:g};return this.mkRequest(e,f,d,this.opts.server+"reversegeocoding/")},getSMP:function(g,f,e,c){var d={cod_calle:g,altura:f};this.mkRequest(d,e,c,this.opts.server+"smp/")},reverse:function(i,c,k,j){var m=b.Deferred(),d=null,f=null,h=null,e=this.reverseGeoCoding(c,i,function(n){d=n},function(n){h=n}),g=this.mkRequest({lat:i,lng:c},function(n){f=n},function(n){h=n},this.opts.reverseService);var l=this;b.when(e,g).then(function(){if(f&&f.direccion){var n=usig.Direccion.fromObj(f);n.clase="DireccionesAMBA";m.resolve(n);if(typeof(k)=="function"){k(n)}}else{if(d){try{var n=l._normalizadorCaba.normalizar(d.esquina)[0];n.setCoordenadas(new usig.Punto(c,i));n.clase="Direcciones";m.resolve(n);if(typeof(k)=="function"){k(n)}}catch(o){}}else{m.fail();if(typeof(j)=="function"){j(o)}}}});return m}})})(jQuery);usig.GeoCoder.defaults={debug:false,server:"//ws.usig.buenosaires.gob.ar/geocoder/2.2/",reverseService:"//servicios.usig.buenosaires.gob.ar/normalizar/",metodo:undefined};if(typeof(usig)=="undefined"){usig={}}usig.SuggesterCoordenadas=(function(b){return usig.Suggester.extend({init:function(c){var d=b.extend({},usig.SuggesterCoordenadas.defaults,c);this._geocoder=new usig.GeoCoder();this._super("Coordenadas",d);if(d.onReady&&typeof(d.onReady)=="function"){d.onReady()}},getSuggestions:function(g,i,h){var d=h!=undefined?h:this.opts.maxSuggestions,f=/(-?\d+\.\d+)\s*,?\s*(-?\d+\.\d+)\s*/g,c=f.exec(g);if(c){try{b.when(this._geocoder.reverse(c[1],c[2])).then(function(j){i([j])})}catch(e){i(e)}}},getGeoCoding:function(c,d){if(typeof(d)=="function"){d(c.getCoordenadas())}},abort:function(){},ready:function(){return true},setOptions:function(c){this._super(c)}})})(jQuery);usig.SuggesterCoordenadas.defaults={serverTimeout:30000,maxRetries:1,maxSuggestions:10};usig.registerSuggester("Coordenadas",usig.SuggesterCoordenadas,'Permite buscar direcciones por coordenadas geográficas tanto en la Ciudad de Buenos Aires como en el área metropolitana. Ej. "-34.624038, -58.417588"');