if(typeof(usig)=="undefined"){usig={}}usig.AjaxComponent=(function(a){return jQuery.Class.create({init:function(e,b,d){this.name=e;var c=d.dataType||(window.location.host==usig.parseUri(b).authority?"json":"jsonp");this.defaultParams={type:"GET",url:b,dataType:c};this.opts=a.extend({},usig.AjaxComponent.defaults,d);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") dataType: "+c)}},mkRequest:function(g,l,j,d){var c=null,h=0,n=a.Deferred();function b(o,p){clearTimeout(c);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success")}if(typeof(this.opts.afterServerResponse)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse")}this.opts.afterServerResponse()}p(o);n.resolve(o)}function f(o,p){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error")}if(h>=this.opts.maxRetries){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Max Errors Reached")}clearTimeout(c);if(typeof(p)=="function"){p(o)}n.reject(o)}else{if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error. Retrying... ("+h+")")}}}function k(o,q){if(o!=null&&o.readyState!=0&&o.readyState!=4){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Aborting request...")}o.abort();if(typeof(this.opts.afterAbort)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort")}this.opts.afterAbort()}if(this.opts.maxRetries>h){h++;var p=a.ajax(q);if(typeof(this.opts.afterRetry)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry")}this.opts.afterRetry()}if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Retrying request... ("+h+")")}c=setTimeout(k.createDelegate(this,[p,m]),this.opts.serverTimeout)}else{if(this.opts.debug){usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito.")}if(typeof(q.error)=="function"){q.error("Se produjo un error al intentar acceder al servidor: "+q.url)}}}}if(typeof(l)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una función que acepte como parámetro el dato solicitado porque puede no estar inmediatamente disponible.")}return}if(typeof(j)!="undefined"&&typeof(j)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una función.")}return}var m=a.extend(true,{},this.defaultParams,{success:b.createDelegate(this,[l],1),error:f.createDelegate(this,[j],1),data:g});if(d){m.url=d}var e=a.ajax(m);if(this.opts.debug){usig.debug(m.dataType+" request...")}if(typeof(this.opts.afterServerRequest)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest")}this.opts.afterServerRequest()}if(this.opts.serverTimeout>0){c=setTimeout(k.createDelegate(this,[e,m]),this.opts.serverTimeout)}return n},setOptions:function(b){this.opts=a.extend({},this.opts,b)},getOptions:function(){return this.opts}})})(jQuery);usig.AjaxComponent.defaults={debug:false,serverTimeout:30000,maxRetries:1};if(typeof(usig)=="undefined"){usig={}}usig.Punto=function(b,a){this.x=this.lon=b;this.y=this.lat=a;this.getX=function(){return this.x};this.getY=function(){return this.y};this.toJson=function(){return'{ "x":'+this.x+', "y": '+this.y+" }"};this.toString=function(){return"("+this.x+", "+this.y+")"}};usig.Punto.fromWkt=function(b){var c=/^POINT *\((-?[0-9]+\.[0-9]+) (-?[0-9]+\.[0-9]+)\)$/;var a=null;if(resMatch=b.match(c)){a=new usig.Punto(resMatch[1],resMatch[2])}return a};usig.Punto.fromPunto=function(a){return new usig.Punto(a.getX(),a.getY())};usig.Punto.fromObj=function(a){return new usig.Punto(a.x,a.y)};usig.Punto.fromArray=function(a){return new usig.Punto(a[0],a[1])};if(typeof(usig)=="undefined"){usig={}}usig.SeccionCatastral=function(a){this.codigoSeccion=a;this.descripcion="Código Sección";this.toString=function(){return this.codigoSeccion}};if(typeof(usig)=="undefined"){usig={}}usig.ManzanaCatastral=function(a){this.codigoManzana=a;this.descripcion="Código Sección-Manzana";this.toString=function(){return this.codigoManzana}};if(typeof(usig)=="undefined"){usig={}}usig.ParcelaCatastral=function(a){this.smp=a.smp;this.pm=a.pm;this.punto=usig.Punto.fromWkt(a.centroide);if(this.pm!=""){this.descripcion="Código Partida-Matriz"}else{this.descripcion="Código Sección-Manzana-Parcela"}this.getPunto=function(){return this.punto};this.toString=function(){if(this.pm!=""){return this.pm}else{return this.smp}}};if(typeof(usig)=="undefined"){usig={}}usig.IndiceCatastral=(function(a){return usig.AjaxComponent.extend({init:function(b){var c=a.extend({},usig.IndiceCatastral.defaults,b);this._super("IndiceCatastral",usig.IndiceCatastral.defaults.server,c);this.showDebug("Creando instancia de usig.IndiceCatastral")},buscar:function(k,l,g,d){var b=/^([0-9]{2})-([0-9]{3}[A-Z]?)-([A-Z0-9]{0,5})$/;var h=/^([0-9]{2})-([0-9]{0,3}|[0-9]{3}[A-Z])$/;var m=/^([0-9]{1,6})$/;var c=/^([0-9]{1,2})$/;var j=/^([1-9][0-9]{0,5})$/;var k=k.toUpperCase();var d=d!=undefined?d:this.opts.maxSuggestions;this.showDebug("-=-=-= Busqueda: "+k+" =-=-=-");function f(o,p,n){var q=[];var n=Math.min(o.datos.length,n);for(i=0;i<n;i++){if(o.tipo=="P"){q.push(new usig.ParcelaCatastral(o.datos[i]))}else{if(o.tipo=="M"){q.push(new usig.ManzanaCatastral(o.seccion+"-"+o.datos[i]))}else{if(o.tipo=="S"){q.push(new usig.SeccionCatastral(o.datos[i]))}}}}this.showDebug(q);if(typeof(p)=="function"){p(q)}}if((resMatch=k.match(b))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,f.createDelegate(this,[l,d],1),g,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2]+"/"+resMatch[3])}else{if((resMatch=k.match(h))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,f.createDelegate(this,[l,d],1),g,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2])}else{if(resMatch=k.match(m)){var e=false;if((k.match(j))&&this.opts.buscarPM){this.lastRequest=this.mkRequest(null,f.createDelegate(this,[l,d],1),g,this.opts.server+"pm/"+resMatch[1]);e=true}if((k.match(c))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,f.createDelegate(this,[l,d],1),g,this.opts.server+"smp/"+resMatch[1]);e=true}if(!e){throw (new usig.IndiceCatastral.WrongParameters)}}else{if(k==""&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,f.createDelegate(this,[l,d],1),g,this.opts.server+"smp/")}else{throw (new usig.IndiceCatastral.WrongParameters())}}}}return},abort:function(){if(this.lastRequest){this.lastRequest.fail();this.lastRequest=null;if(typeof(this.opts.afterAbort)=="function"){this.opts.afterAbort()}}},showDebug:function(b){if(this.opts.debug){usig.debug(b)}}})})(jQuery);usig.IndiceCatastral.WrongParameters=function(){this.msg="Los parametros ingresados son incorrectos.";this.getErrorMessage=function(){return this.msg}};usig.IndiceCatastral.defaults={debug:false,server:"http://inventario.usig.buenosaires.gob.ar/indice_catastral/",maxSuggestions:10,buscarSMP:true,buscarPM:true};if(typeof(usig)=="undefined"){usig={}}usig.SuggesterCatastro=(function(a){return usig.Suggester.extend({init:function(b){var c=a.extend({},usig.SuggesterCatastro.defaults,b);this._super("Catastro",c);if(!this.opts.indiceCatastral){this.opts.indiceCatastral=new usig.IndiceCatastral(c);this.cleanList.push(this.opts.indiceCatastral)}if(c.onReady&&typeof(c.onReady)=="function"){c.onReady()}},getSuggestions:function(d,f,e){var b=e!=undefined?e:this.opts.maxSuggestions;try{this.opts.indiceCatastral.buscar(d,f,function(){},b)}catch(c){f(c)}},getGeoCoding:function(b,c){if(!(b instanceof usig.ParcelaCatastral)){c(new usig.Suggester.GeoCodingTypeError())}else{c(b.getPunto())}},abort:function(){this.opts.indiceCatastral.abort()},ready:function(){return true},setOptions:function(b){this._super(b);this.opts.indiceCatastral.setOptions(b)}})})(jQuery);usig.SuggesterCatastro.defaults={debug:false,serverTimeout:5000,maxRetries:5,maxSuggestions:10};usig.registerSuggester("Catastro",usig.SuggesterCatastro,"Permite buscar parcelas en la Ciudad de Buenos Aires por código de sección-manzana-parcela o bien por partida matriz");